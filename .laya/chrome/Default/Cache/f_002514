function User(){this.state="pregame",this.id=Math.floor(1e6*Math.random()),this.name="",this.userName="",this.avatar="css/images/default-avatar.png",this.gold=100,this.exp=0,this.level=0,this.expForLevel=0,this.expToNextlevel=0,this.mineCount_total=0,this.flaggedMiss_total=0,this.triggerMine_total=0,this.longestStreak=0,this.multiplier_max=0,this.gamesPlayed=0,this.hasShared=!1,this.hasSeenHowToPlay=!1;var e=[16,17,18,19],t=e[Math.floor(Math.random()*e.length)];this.flag=t,this.flags=[t],this.achievements=[]}function MinesweeperProxy(e,t,i,a,n){this.id=e||Math.floor(1e6*Math.random()),this.state="pregame",this.width=t,this.height=i,this.edgeSize=2,this.mineGrid=new Array2D(this.width,this.height,MineCell.HIDDEN),this.playGrid=new Array2D(this.width,this.height,MineCell.BLANK),this.flagCount=0,this.mineCount=0,this.minesLeft=0,this.points=0,this.multiplier=1,this.flagMode=!1,this.showLeaderboard=!0,this.debug=!1,this.startTime=Date.now(),this.players=[],this.localPlayerId=null,this.onMessage=function(e,t,i){},this.onMessage2=function(e,t,i){},this.serverUrl=n,localStorage&&"true"===localStorage.debug&&(this.debug=!0);var s=this;this.serverUrl||(this.serverUrl="ws://localhost:8005");var o=null;this.message=function(e,t,i){void 0!==console.log&&this.debug===!0&&console.log(e+" : "+t+" : "+i+" : "+this.getElaspedTime());var a=this.user;a&&a.onGameMessage&&a.onGameMessage(e,t,i),this.onMessage&&this.onMessage(e,t,i),this.onMessage2&&this.onMessage2(e,t,i)},this.sendMessage=function(e,t){var i=e+":"+JSON.stringify(t);this.debug&&console.log("sendMessage: "+i),o.send(i)},this.onOpen=function(e){},this.onClosed=function(e){s.leave()},this.onError=function(e){console.error("Error connecting to server"),s.localPlayerId&&(alert("Error connecting to server. Try again later."),s.leave())},this.onSocketMessage=function(e){if(e){var t=s.phaseData(e),i=t.command,a=t.value;"leave"===i&&s.onLeave(a),"join"===i&&s.onJoin(a),"fullGameState"===i&&s.onFullGameState(a),"fullPlayGrid"===i&&s.onFullPlayGrid(a),"cellChanged"===i&&s.onCellChanged(a),"stateChanged"===i&&s.onStateChanged(a),"gameStats"===i&&s.onGameStats(a),"scoreChanged"===i&&s.onScoreChanged(a),"multiplierChanged"===i&&s.onMultiplierChanged(a),"streakBonus"===i&&s.onStreakBonus(a),"playerData"===i&&s.onPlayerData(a),"revealCell"===i&&s.onRevealCell(a),"flaggedMine"===i&&s.onFlaggedMine(a),"flaggedMiss"===i&&s.onFlaggedMiss(a),"triggerMine"===i&&s.onTriggerMine(a),"restarting"===i&&s.onRestarting(a),"gameOver"===i&&s.onGameOver(a)}},this.phaseData=function(e){var t=null,i=null;if("string"==typeof e)if(e.indexOf(":")>-1){t=e.split(":")[0],i=e.substring(e.indexOf(":")+1);try{i=JSON.parse(i)}catch(a){}}else t=e;else{var n=new DataView(e),s=n.getUint8(0);if(1===s){t="fullPlayGrid";for(var o=n.getUint8(1),r=n.getUint8(2),l=new Uint8ClampedArray(o*r),h=new Uint8ClampedArray(e,7),d=0;d<l.length;d++)l[d]=h[d];var u={data:l,width:o,height:r};i=u}if(2===s){t="cellChanged";for(var g=[],d=1;d<n.byteLength;d+=3){var m={};m.x=n.getUint8(d+0),m.y=n.getUint8(d+1),m.value=n.getUint8(d+2),g.push(m)}i=g}if(3===s){t="playerData";var c=new Uint32Array(e),p={};p.id=c[1],p.x=c[2],p.y=c[3],p.points=c[4],i=p}}var f={command:t,value:i};return f},this.destroy=function(){s.message("destroy"),o.close(),this.onMessage=null,this.onMessage2=null},this.getState=function(){s.sendMessage("fullGameState")},this.reset=function(){s.sendMessage("reset")},this.login=function(e){e.game=s,this.localPlayerId=e.id,s.sendMessage("login",e);var t=s.getPlayer(e.id);t||(t=this.join(e))},this.pause=function(){s.paused=!0,s.message("pause")},this.resume=function(){s.paused=!1,s.message("resume")},this.onLeave=function(){s.leave()},this.onJoin=function(e){if(e){var t=s.getPlayer(e.id);t||(t=s.createPlayer(e.id)),e.name&&(t.name=e.name),e.flag&&(t.flag=e.flag),t.x=e.x,t.y=e.y,t.points=e.points||t.points,s.message("join",t)}},this.onFullGameState=function(e){s.flagCount=0,s.mineCount=e.mineCount,s.players=e.players;var t=s.state;s.state=e.state,s.state!==t&&s.message("stateChanged",s.state),s.minesLeft=e.minesLeft,s.message("fullGameState")},this.onFullPlayGrid=function(e){s.playGrid.data=null,s.playGrid=new Array2D(e.width,e.height,0),s.playGrid.data=new Uint8ClampedArray(e.data),s.message("fullPlayGrid")},this.onCellChanged=function(e){for(var t=e.length,i=0;i<t;i++){var a=e[i];s.playGrid.set(a.x,a.y,a.value)}s.message("cellChanged",e)},this.onStateChanged=function(e){s.state;s.state=e,s.message("stateChanged",s.state),s.message("gameStats")},this.onGameStats=function(e){s.minesLeft=e.minesLeft;for(var t=0;t<e.players.length;++t){var i=e.players[t],a=s.getPlayer(i.id);a||(a=s.createPlayer(i.id)),a.name=i.name||a.name,a.flag=i.flag||a.flag,a.x=i.x||a.x,a.y=i.y||a.y,a.points=i.points||a.points}s.message("gameStats")},this.onScoreChanged=function(e){if(s.localPlayerId){var t=s.getPlayer(s.localPlayerId);t.points=e.total}s.message("scoreChanged",e)},this.onMultiplierChanged=function(e){if(s.localPlayerId){var t=s.getPlayer(s.localPlayerId);t.multiplier=e.multiplier}s.message("multiplierChanged",e)},this.onStreakBonus=function(e){s.points=e.total,s.message("streakBonus",e)},this.onRevealCell=function(e,t){s.message("revealCell",e,t)},this.onFlaggedMine=function(e,t){s.message("flaggedMine",e,t)},this.onFlaggedMiss=function(e,t){s.message("flaggedMiss",e,t)},this.onTriggerMine=function(e,t){s.message("triggerMine",e,t)},this.onRestarting=function(e,t){s.message("restarting",e,t)},this.onPlayerData=function(e){if(e){var t=s.getPlayer(e.id);t||(t=s.createPlayer(e.id)),e.name&&(t.name=e.name),e.flag&&(t.flag=e.flag),t.x=e.x,t.y=e.y,t.points=e.points||t.points,s.message("playerData",e)}},this.onGameOver=function(e,t){s.message("gameOver",e,t)},this.getElaspedTime=function(){return(Date.now()-this.startTime)/1e3},this.init=function(){return new Promise(function(e,t){o=new WebSocket(s.serverUrl),o.binaryType="arraybuffer",o.onopen=function(e){s.onOpen(e)},o.onclose=function(e){s.onClosed(e)},o.onmessage=function(e){s.onSocketMessage(e.data)},o.onerror=function(e){s.onError(e)},s.state="pregame",s.players=[],s.mineCount=Math.floor(s.mineCount),s.mineCount>s.width*s.height-9&&(s.mineCount=s.width*s.height-9),s.minesLeft=s.mineCount,s.playGrid.clear(MineCell.HIDDEN),s.mineGrid.clear(MineCell.BLANK),s.flagCount=0,s.message("init"),s.message("stateChanged","pregame"),o.onopen=function(t){e()},o.onerror=function(e){t(e)}})},this.join=function(e){e.game=this,this.user=e,this.localPlayerId=e.id;var t={};t.id=e.id,t.name=e.name,t.flag=e.flag,t.avatar=e.avatar,s.sendMessage("login",t)},this.createPlayer=function(e){var t=s.getPlayer(e);if(!t){var t={};return t.id=e,this.players.push(t),t}},this.leave=function(){if(s.localPlayerId){var e=s.getPlayer(s.localPlayerId);s.localPlayerId=null,s.message("leave",null,e),s.sendMessage("leaveGame",e),s.destroy()}},this.leaderboardToggle=function(){s.showLeaderboard=!s.showLeaderboard,s.message("showLeaderBoard")},this.getGameStats=function(e){this.getPlayer(e);return{minesLeft:this.minesLeft}},this.getPlayer=function(e){if(!e)return null;for(var t=0;t<this.players.length;++t)if(this.players[t].id===e)return this.players[t]},this.createGrid=function(e,t,i){var a=2;t+=2*a,e+=2*a;for(var n=new Array2D(e,t,i),s=0;s<n.width;s+=1)for(var o=0;o<a;o+=1)n.set(s,o,MineCell.EDGE),n.set(s,n.height-1-o,MineCell.EDGE);for(var r=0;r<n.height;r+=1)for(var o=0;o<a;o+=1)n.set(o,r,MineCell.EDGE),n.set(n.width-1-o,r,MineCell.EDGE);return n},this.moveView=function(e,t,i){e=Number(e),t=Number(t),s.sendMessage("moveView",{x:e,y:t})},this.placeFlag=function(e,t){e=Number(e),t=Number(t),s.sendMessage("placeFlag",{x:e,y:t})},this.revealCell=function(e,t){e=Number(e),t=Number(t),s.sendMessage("revealCell",{x:e,y:t})},this.printGrid=function(e){for(var t="",i=0;i<e.height;i+=1){for(var a=0;a<e.width;a+=1){var n=e.get(a,i);t+=n+" "}t+="\n"}return t}}var openFB=function(){function e(e){if(!e.appId)throw"appId parameter not set in init()";d=e.appId,e.tokenStore&&(w=e.tokenStore),e.accessToken&&(w.fbAccessToken=e.accessToken),f=e.loginURL||f,v=e.logoutURL||v,P=e.oauthRedirectURL||P,I=e.cordovaOAuthRedirectURL||I,x=e.logoutRedirectURL||x}function t(e){var t=w.fbAccessToken,i={};t?(i.status="connected",i.authResponse={accessToken:t}):i.status="unknown",e&&e(i)}function i(e,t){function i(e){var t=e.url;if(t.indexOf("access_token=")>0||t.indexOf("error=")>0){var i=600-((new Date).getTime()-o);setTimeout(function(){s.close()},i>0?i:0),a(t)}}function n(){console.log("exit and remove listeners"),u&&!c&&u({status:"user_cancelled"}),s.removeEventListener("loadstop",i),s.removeEventListener("exit",n),s=null,console.log("done removing listeners")}var s,o,r="",l=m?I:P;return d?(t&&t.scope&&(r=t.scope),u=e,c=!1,o=(new Date).getTime(),s=window.open(f+"?client_id="+d+"&redirect_uri="+l+"&response_type=token&scope="+r,"_blank","location=no,clearcache=yes"),void(m&&(s.addEventListener("loadstop",i),s.addEventListener("exit",n)))):e({status:"unknown",error:"Facebook App Id not set."})}function a(e){var t,i;c=!0,e.indexOf("access_token=")>0?(t=e.substr(e.indexOf("#")+1),i=l(t),w.fbAccessToken=i.access_token,u&&u({status:"connected",authResponse:{accessToken:i.access_token}})):e.indexOf("error=")>0?(t=e.substring(e.indexOf("?")+1,e.indexOf("#")),i=l(t),u&&u({status:"not_authorized",error:i.error})):u&&u({status:"not_authorized"})}function n(e){var t,i=w.fbAccessToken;w.removeItem("fbAccessToken"),i&&(t=window.open(v+"?access_token="+i+"&next="+x,"_blank","location=no,clearcache=yes"),m?setTimeout(function(){t.close()},700):t.close()),e&&e()}function s(e,t){function i(e){var i=e.url;if(i.indexOf(o)!=-1){var a=600-((new Date).getTime()-s);setTimeout(function(){n.close()},a>0?a:0),p=!0,t&&t(i)}}function a(){console.log("exit and remove listeners"),g&&!p&&g({status:"user_cancelled"}),n.removeEventListener("loadstop",i),n.removeEventListener("exit",a),n=null,console.log("done removing listeners")}var n,s,o=m?I:P;return d?(g=t,p=!1,s=(new Date).getTime(),n=window.open(y+"?app_id="+d+"&redirect_uri="+o+"&message="+e+"&filters=[%27app_non_users%27]","_blank","location=no,clearcache=yes"),void(m&&(n.addEventListener("loadstop",i),n.addEventListener("exit",a)))):void(t&&t({status:"unknown",error:"Facebook App Id not set."}))}function o(e){var t,i=e.method||"GET",a=e.params||{},n=new XMLHttpRequest;a.access_token=w.fbAccessToken,t="https://graph.facebook.com"+e.path+"?"+h(a),n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status)e.success&&e.success(JSON.parse(n.responseText));else{var t=n.responseText?JSON.parse(n.responseText).error:{message:"An error has occurred"};e.error&&e.error(t)}},n.open(i,t,!0),n.send()}function r(e,t){return o({method:"DELETE",path:"/me/permissions",success:function(){e()},error:t})}function l(e){var t=decodeURIComponent(e),i={},a=t.split("&");return a.forEach(function(e){var t=e.split("=");i[t[0]]=t[1]}),i}function h(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}var d,u,g,m,c,p,f="https://www.facebook.com/dialog/oauth",y="https://www.facebook.com/dialog/apprequests",v="https://www.facebook.com/logout.php",w=window.sessionStorage,M=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")),C=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+M,P=C+"/oauthcallback.html",I="https://www.facebook.com/connect/login_success.html",x=C+"/logoutcallback.html";return document.addEventListener("deviceready",function(){m=!0},!1),{init:e,login:i,logout:n,revokePermissions:r,api:o,oauthCallback:a,getLoginStatus:t,dialogAppRequest:s}}();if(Facebook={appId:"1833297510234856",Version:"1.0.0.0"},Facebook.logoutFacebook=function(){openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.logout()},Facebook.loginFacebook=function(e){openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.login(function(t){"connected"===t.status?Facebook.getInfo(t.authResponse.accessToken,e):alert("Facebook login failed: "+t.error)},{scope:"email,user_friends"})},Facebook.getInfo=function(e,t){e?openFB.init({appId:Facebook.appId,accessToken:e}):openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.api({path:"/me",params:{fields:"id,first_name,email"},success:function(i){console.log(JSON.stringify(i)),i.accessToken=e,t&&t(i)},error:function(e){Facebook.logoutFacebook()}})},Facebook.getFriends=function(e,t,i){e?openFB.init({appId:Facebook.appId,accessToken:e}):openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.api({path:"/me/friends",success:function(e){console.log(JSON.stringify(e)),t&&t(e)},error:function(e){i&&i(e)}})},Facebook.getInvitableFriends=function(e,t,i){e?openFB.init({appId:Facebook.appId,accessToken:e}):openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.api({path:"/me/invitable_friends",success:function(e){console.log(JSON.stringify(e)),t&&t(e)},error:function(e){i&&i(e)}})},Facebook.showAppRequests=function(e,t,i){openFB.init({appId:Facebook.appId}),openFB.dialogAppRequest(e,function(e){})},Facebook.getPermissions=function(e,t,i){e?openFB.init({appId:Facebook.appId,accessToken:e}):openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.api({path:"/me/permissions",success:function(e){console.log(JSON.stringify(e)),t&&t(e)},error:function(e){i&&i(e)}})},Facebook.ping=function(e,t){console.log("Pinging facebook ..."),e?openFB.init({appId:Facebook.appId,accessToken:e}):openFB.init({appId:Facebook.appId,tokenStore:window.localStorage}),openFB.api({path:"/me",success:function(e){console.log("Facebook pinged:"),console.log(JSON.stringify(e)),t&&t(e)},error:function(e){console.log("Facebookping failed: "+e.message)}})},Facebook.openCommunityPage=function(){alert("Facebook.openCommunityPage "),window.open("https://www.facebook.com/847181962036765","_system")},AnalyticsGA={AppName:"Minesweeper.io",Version:"1.3.8",Property:"UA-43146845-17",AnalyticsGA:""},AnalyticsGA.TrackStart=function(e,t,i){"undefined"!=typeof e&&(AnalyticsGA.AppName=e),"undefined"!=typeof t&&(AnalyticsGA.Version=t),"undefined"!=typeof i&&(AnalyticsGA.Property=i)},AnalyticsGA.onDeviceReady=function(){if(document.removeEventListener("deviceready",AnalyticsGA.onDeviceReady,!1),"undefined"!=typeof window.analytics){Config&&Config.debugMode&&window.analytics.debugMode(),window.analytics.startTrackerWithId(AnalyticsGA.Property);var e=AnalyticsGA.GetUserID();window.analytics.setUserId(e)}},AnalyticsGA.GetUserID=function(){var e=null;return null===e&&(e=localStorage.getItem("uuid"),null===e&&"undefined"!=typeof device&&"undefined"!==device.uuid&&(e=device.uuid),null===e&&(e=Math.floor(9e7*Math.random())+1e7,localStorage.uuid=e)),e},AnalyticsGA.TrackPage=function(e){AnalyticsGA.currentPage=e,AnalyticsGA.TrackPageNoSDK(e)},AnalyticsGA.onDeviceReadyTrackPage=function(){document.removeEventListener("deviceready",AnalyticsGA.onDeviceReadyTrackPage,!1),"undefined"!=typeof window.analytics&&window.analytics.trackView(AnalyticsGA.currentPage)},AnalyticsGA.TrackEvent=function(e,t,i,a){var n=!!window.cordova;n?"undefined"!=typeof window.analytics&&window.analytics.trackEvent(e,t,i,a):Config&&Config.DebugMode&&console.log("AnalyticsGA: AnalyticsGA.TrackEvent not set up for non SDK(web)")},AnalyticsGA.TrackPageNoSDK=function(e){var t=AnalyticsGA.AppName,i=AnalyticsGA.Version,a=AnalyticsGA.Property;if(navigator.connection&&"none"===navigator.connection.type)return void console.log("AnalyticsGA: No connection: skipping");"undefined"==typeof ga&&(window.crypto=window.crypto||window.msCrypto,function(e,t,i,a,n,s,o){e.GoogleAnalyticsObject=n,e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},e[n].l=1*new Date,s=t.createElement(i),o=t.getElementsByTagName(i)[0],s.async=1,s.src=a,o.parentNode.insertBefore(s,o)}(window,document,"script","js/Analytics_Google.js","ga"));var n=AnalyticsGA.GetUserID();ga("create",a,{storage:"none",clientId:n}),ga("set","checkProtocolTask",null),ga("set","checkStorageTask",null),ga("set","appVersion",i),ga("set","appName",t),ga("send","screenview",{screenName:e,page:e}),ga("send","pageview",e)},AnalyticsJI={AppName:"NoName",Version:"0.0.0.0"},AnalyticsJI.TrackStart=function(e,t,i){i||(i=AnalyticsJI.GetOS()),localStorage.appName=e,localStorage.version=t,localStorage.os=i,this.Track("Start")},AnalyticsJI.TrackPage=function(e,t){this.Track("PageView",e,t)},AnalyticsJI.Track=function(e,t,i){var a=localStorage.getItem("appName"),n=localStorage.getItem("version"),s=localStorage.getItem("os"),o=null;"undefined"!=typeof device&&"undefined"!==device.uuid&&(o=device.uuid),null===o&&(o=localStorage.getItem("uuid"),null===o&&(o=Math.floor(9e7*Math.random())+1e7,localStorage.uuid=o));var r=null;r=sessionStorage.getItem("sessionid"),null===r&&(r=Math.floor(9e7*Math.random())+1e7,sessionStorage.sessionid=r);var l=window.navigator.userLanguage||window.navigator.language;this.SendData(a,n,e,t,i,l,r,o,s)},AnalyticsJI.GetOS=function(){var e="Other",t=navigator.userAgent,i=/Kindle/i.test(t)||/Silk/i.test(t)||/Amazon/i.test(t)||/KFTT/i.test(t)||/KFOT/i.test(t)||/KFJWA/i.test(t)||/KFJWI/i.test(t)||/KFSOWI/i.test(t)||/KFTHWA/i.test(t)||/KFTHWI/i.test(t)||/KFAPWA/i.test(t)||/KFAPWI/i.test(t);/(android)/i.test(navigator.userAgent)&&i?e="Amazon":/(android)/i.test(navigator.userAgent)&&!i?e="Android":/(ipod|iphone|ipad)/i.test(navigator.userAgent)?e="iOS":/(windows phone)/i.test(navigator.userAgent)?e="WindowsPhone":/(windows)/i.test(navigator.userAgent)&&(e="Windows");var a=!!window.cordova;return a&&(e+="Mobile"),e},AnalyticsJI.SendData=function(e,t,i,a,n,s,o,r,l){var h=null,d="https://www.jimmyinteractive.com/WP7/Service.svc/LogEvent?";"http:"===window.location.protocol&&(d="http://www.jimmyinteractive.com/WP7/Service.svc/LogEvent?"),s||(s=""),r||(r=""),o||(o=""),t||(t=""),a||(a=""),n||(n=""),l||(l=""),s=encodeURIComponent(s),r=encodeURIComponent(r),o=encodeURIComponent(o),t=encodeURIComponent(t),a=encodeURIComponent(a),n=encodeURIComponent(n),l=encodeURIComponent(l),d=d+"AppName="+e+"&Event="+i+"&Culture="+s+"&DeviceUniqueID="+r+"&SessionID="+o+"&Version="+t+"&Parameter1="+a+"&Parameter2="+n+"&LiveAnonymousID=&OS="+l+"&Random="+Math.floor(1e6*Math.random());try{h=new XMLHttpRequest,h.open("GET",d,!0),h.send(null)}catch(u){}},Achievement={},Achievement.onNewAchievement=function(){},Achievement.rewardAchievement=function(e,t){e.achievements||(e.achievements=[]),e.gold||(e.gold=0);var i=e.achievements.indexOf(t)!==-1;if(i!==!0){var a=Achievement.getAchievement(t);a&&(e.achievements.push(a.Name),e.gold+=Number(a.Points)||0,Achievement.onNewAchievement&&Achievement.onNewAchievement([a]))}},Achievement.checkForAchievementAndReward=function(e){e.achievements||(e.achievements=[]),e.gold||(e.gold=0);for(var t=Achievement.checkForAchievement(e,{},e.achievements),i=0;i<t.length;i++){var a=t[i];e.achievements.push(a.Name),e.gold+=Number(a.Points)||0}Achievement.onNewAchievement&&Achievement.onNewAchievement(t)},Achievement.checkForAchievement=function(e,t,i){for(var a=[],n=0;n<Achievement.allAchievements.length;n++){var s=Achievement.allAchievements[n];if(i){var o=i.indexOf(s.Name)!==-1;if(o===!0)continue}void 0!=s.Check&&s.Check(e||{},t||{})&&a.push(s)}return a},Achievement.getAchievement=function(e){for(key in Achievement.allAchievements){var t=Achievement.allAchievements[key];if(t.Name===e)return t}},Achievement.allAchievements=[{Name:"Played First Game",Category:"Overall",Title:"Let the Games Begin",Description:"Played First Game",Image:"ace.png",Points:"25",PushToFacebook:"true",Order:"1",Check:function(e,t){return e.gamesPlayed>0}},{Name:"Play 5 Games",Category:"Easy",Title:"Piece of Cake",Description:"Play 5 games to the end",Image:"cake-slice.png",Points:"50",PushToFacebook:"true",Order:"2",Check:function(e,t){return e.gamesPlayed>=5}},{Name:"Play 10 Games",Category:"Medium",Title:"Quick Flyer",Description:"Play 10 games",Image:"dragonfly.png",Points:"75",PushToFacebook:"true",Order:"4",Check:function(e,t){return e.gamesPlayed>=10}},{Name:"Play 50 Games",Category:"Medium",Title:"Growing Force",Description:"Play 50 games",Image:"bee.png",Points:"100",PushToFacebook:"true",Order:"5",Check:function(e,t){return e.gamesPlayed>=20}},{Name:"Play 100 Games",Category:"Medium",Title:"Little Fighter",Description:"Play 100 games",Image:"wasp-sting.png",Points:"125",PushToFacebook:"true",Order:"6",Check:function(e,t){return e.gamesPlayed>=100}},{Name:"Play 200 Games",Category:"Medium",Title:"Little Champion",Description:"Play 200 games",Image:"scarab-beetle.png",Points:"150",PushToFacebook:"true",Order:"7",Check:function(e,t){return e.gamesPlayed>=200}},{Name:"Play 500 Games",Category:"Medium",Title:"Made Flight",Description:"Play 500 games",Image:"butterfly.png",Points:"150",PushToFacebook:"true",Order:"3",Check:function(e,t){return e.gamesPlayed>=500}},{Name:"Streak (10x)",Category:"Other",Title:"Streak (10x)",Description:"Play 10 moves without a mistake",Image:"strong4.png",Points:"25",PushToFacebook:"true",Order:"87",Check:function(e,t){return e.longestStreak>=10}},{Name:"Great Streak (25x)",Category:"Other",Title:"Great Streak (25x)",Description:"Play 25 moves without a mistake",Image:"strong5.png",Points:"50",PushToFacebook:"true",Order:"88",Check:function(e,t){return e.longestStreak>=25}},{Name:"Super Streak (50x)",Category:"Other",Title:"Super Streak (50x)",Description:"Play 50 moves without a mistake",Image:"strong6.png",Points:"75",PushToFacebook:"true",Order:"89",Check:function(e,t){return e.longestStreak>=50}},{Name:"Crazy Streak (75x)",Category:"Other",Title:"Crazy Streak (75x)",Description:"Play 75 moves without a mistake",Image:"strong7.png",Points:"100",PushToFacebook:"true",Order:"90",Check:function(e,t){return e.longestStreak>=75}},{Name:"On Fire Streak (100x)",Category:"Other",Title:"On Fire Streak (100x)",Description:"Play 100 moves without a mistake",Image:"strong8.png",Points:"125",PushToFacebook:"true",Order:"91",Check:function(e,t){return e.longestStreak>=100}},{Name:"Ninja Streak (150x)",Category:"Other",Title:"Ninja Streak (150x)",Description:"Play 150 moves without a mistake",Image:"strong9.png",Points:"150",PushToFacebook:"true",Order:"92",Check:function(e,t){return e.longestStreak>=150}},{Name:"Crazy Ninja Streak (200x)",Category:"Other",Title:"Crazy Ninja Streak (200x)",Description:"Play 200 moves without a mistake",Image:"strong10.png",Points:"200",PushToFacebook:"true",Order:"93",Check:function(e,t){return e.longestStreak>=200}},{Name:"50 Mines Cleared",Category:"Hard",Title:"Got Your Feet Wet",Description:"Clear a total of 50 mines",Image:"ammonite.png",Points:"25",PushToFacebook:"true",Order:"9",Check:function(e,t){return e.mineCount_total>=50}},{Name:"100 Mines Cleared",Category:"Hard",Title:"Neigh to Losing",Description:"Clear a total of 100 mines",Image:"horse-head.png",Points:"50",PushToFacebook:"true",Order:"10",Check:function(e,t){return e.mineCount_total>=100}},{Name:"250 Mines Cleared",Category:"Hard",Title:"Hard to Beat",Description:"Clear a total of 250 mines",Image:"turtle.png",Points:"75",PushToFacebook:"true",Order:"11",Check:function(e,t){return e.mineCount_total>=250}},{Name:"500 Mines Cleared",Category:"Hard",Title:"Fast And Silent",Description:"Clear a total of 500 mines",Image:"frog.png",Points:"100",PushToFacebook:"true",Order:"12",Check:function(e,t){return e.mineCount_total>=500}},{Name:"750 Mines Cleared",Category:"Hard",Title:"Choice Fish",Description:"Clear a total of 750 mines",Image:"angler-fish.png",Points:"125",PushToFacebook:"true",Order:"13",Check:function(e,t){return e.mineCount_total>=750}},{Name:"1000 Mines Cleared",Category:"Hard",Title:"Ninja Fish",Description:"Clear a total of 1000 mines",Image:"angler-fish.png",Points:"150",PushToFacebook:"true",Order:"13",Check:function(e,t){return e.mineCount_total>=1e3}},{Name:"1500 Mines Cleared",Category:"Hard",Title:"Crazy Ninja Fish",Description:"Clear a total of 1500 mines",Image:"angler-fish.png",Points:"174",PushToFacebook:"true",Order:"13",Check:function(e,t){return e.mineCount_total>=1500}},{Name:"Share On Facebook",Category:"Online",Title:"Get The Party Started",Description:"Share on facebook",Image:"minions.png",Points:"100",Order:"120",Check:function(e,t){return!1}},{Name:"Share On Twitter",Category:"Online",Title:"Get The Party Started",Description:"Share on twitter",Image:"minions.png",Points:"100",Order:"120",Check:function(e,t){return!1}}],Level={},Level.addExp=function(e,t){e.exp=(e.exp||0)+t;var i=Level.checkLevel(e);return i},Level.checkLevel=function(e){var t=e.level||1,i=e.exp||0,a=0,n=0;return t=this.getLevelFromExp(i),a=i-this.getExpNeededForLevel(t),n=this.getExpNeededForLevel(t+1),t!==e.level&&e.level>0&&(e.gold+=50),e.level=t,e.expForLevel=a,e.expToNextlevel=n,t},Level.getLevelFromExp=function(e){var t=Math.floor(Math.pow(e,.5)/7)+1;return t},Level.getExpNeededForLevel=function(e){var t=Math.pow(7*(e-1),2);return t},Storage={},Storage.save=function(e,t){localStorage[e]=JSON.stringify(t)},Storage.load=function(e){var t=localStorage.getItem(e),i=null;if(null!==t)try{i=JSON.parse(t)}catch(a){i=null}return i},Array2D=function(e,t,i){this.width=e,this.height=t,this.data=new Uint8ClampedArray(e*t),this.length=this.data.length;for(var a=0;a<this.length;a++)this.data[a]=i;this.clear=function(e){for(var t=0;t<this.length;t++)this.data[t]=e},this.get=function(e,t){return e=Number(e),t=Number(t),e<0?null:t<0?null:e<0?null:e>=this.width?null:t>=this.height?null:this.data[e+t*this.width]},this.set=function(e,t,i){if(e=Number(e),t=Number(t),e<0)throw"index out of range";if(t<0)throw"index out of range";if(e<0)throw"index out of range";if(e>=this.width)throw"index out of range";if(t>=this.height)throw"index out of range";this.data[e+t*this.width]=i},this.getNeighbors=function(e,t){var i,a=[],n=this;return i=n.get(e-1,t-1),null!==i&&a.push({x:e-1,y:t-1}),i=n.get(e-0,t-1),null!==i&&a.push({x:e-0,y:t-1}),i=n.get(e+1,t-1),null!==i&&a.push({x:e+1,y:t-1}),i=n.get(e-1,t),null!==i&&a.push({x:e-1,y:t}),i=n.get(e+1,t),null!==i&&a.push({x:e+1,y:t}),i=n.get(e+1,t+1),null!==i&&a.push({x:e+1,y:t+1}),i=n.get(e-1,t+1),null!==i&&a.push({x:e-1,y:t+1}),i=n.get(e-0,t+1),null!==i&&a.push({x:e-0,y:t+1}),a}},"undefined"!=typeof module&&(module.exports=Array2D),MineCell={BLANK:9,BOMB:0,FLAG:16,BOMBHIT:0,HIDDEN:10,PROX1:1,PROX2:2,PROX3:3,PROX4:4,PROX5:5,PROX6:6,PROX7:7,PROX8:8,EDGE:11},"undefined"!=typeof module&&(module.exports=MineCell),PlayerLocal=function(e,t,i,a){this.id=e||Math.floor(1e8*Math.random()),this.name=t,this.flag=i||15,this.game=a,this.level="basic",this.avatar,this.mineCount=0,this.points=0,this.multiplier=1,this.isComputer=!0,this.computerTimer,this.computerDelay=1500;var n=Math.floor(1e3*Math.random());this.computerDelay=this.computerDelay+n;this.onGameMessage=function(e,t,i){},this.start=function(){},this.pause=function(){},this.resume=function(){},this.destroy=function(){},this.gameover=function(){},this.stopComputer=function(){},this.join=function(e){}},"undefined"!=typeof module&&(module.exports=PlayerComputer),"undefined"!=typeof require)var Array2D=require("./array2D"),MineCell=require("./mineCell");var Minesweeper=function(e,t,i,a,n){this.id=e||Math.floor(1e6*Math.random()),this.state="pregame",this.width=t,this.height=i,this.edgeSize=2,this.height+=2*this.edgeSize,this.width+=2*this.edgeSize,this.mineGrid=new Array2D(this.width,this.height,MineCell.HIDDEN),this.playGrid=new Array2D(this.width,this.height,MineCell.BLANK),this.singlePlayerRules=!1,this.flagCount=0,this.mineCount=a,this.imageMap=n,this.minesLeft=0,this.flagMode=!1,this.showLeaderboard=!0,this.debug=!0,this.startTime=Date.now(),this.players=[],this.users=[],this.maxPlayers=10;var s=this;this.destroy=function(){s.message("destroy"),this.onMessage=null,this.onMessage2=null},this.onMessage=function(e,t,i){},this.message=function(e,t,i){void 0!==console.log&&this.debug===!0&&console.log(e+" : "+t+" : "+(i?i.name:"")+" : "+this.getElaspedTime());for(var a=0;a<this.users.length;a++){var n=this.users[a];n&&n.onGameMessage&&n.onGameMessage(e,t,i)}this.onMessage&&this.onMessage(e,t,i),this.onMessage2&&this.onMessage2(e,t,i)},this.getElaspedTime=function(){return(Date.now()-this.startTime)/1e3},this.init=function(){this.state="pregame",this.players=[],this.mineCount=Math.floor(this.mineCount),this.mineCount>this.width*this.height-9&&(this.mineCount=this.width*this.height-9),this.minesLeft=this.mineCount,this.playGrid.clear(MineCell.HIDDEN),this.mineGrid.clear(MineCell.BLANK),this.createGridEdge(this.playGrid),this.createGridEdge(this.mineGrid),this.flagCount=0,this.message("init"),this.message("stateChanged","pregame")},this.getState=function(){s.message("fullGameState")},this.restart=function(){s.init()},this.pause=function(){s.paused=!0,s.message("pause")},this.resume=function(){s.paused=!1,s.message("resume")},this.restartDelay=function(e){var t=e||10;s.restartCountDown=t,s.message("restarting",s.restartCountDown);var i=setInterval(function(){s.restartCountDown-=1,s.message("restarting",s.restartCountDown),s.restartCountDown<=0&&(s.init(),clearInterval(i))},1e3)},this.join=function(e){e.game=this,this.containsUser(e)||this.users.push(e);var t=this.getPlayer(e.id);return t?(t.name=e.name,t.flag=e.flag||12):(t={},t.id=e.id||Math.floor(1e6*Math.random()),t.name=e.name,t.flag=e.flag||12,t.mineCount=0,t.points=0,t.flaggedMiss=0,t.triggerMineCount=0,t.longestStreak=0,t.currentStreak=0,t.streakBonus=0,t.multiplier=1,t.multiplier_max=0,this.players.push(t)),this.message("join",null,t),e},this.leave=function(e){var t=s.getUser(e);if(t){var i=this.users.indexOf(t);s.users.splice(i,1),s.message("leave",null,t),t.game=null}},this.isFull=function(){for(var e=0,t=0;t<this.users.length;++t){var i=this.users[t];i.isComputer||e++}return e>=this.maxPlayers},this.leaderboardToggle=function(){s.showLeaderboard=!s.showLeaderboard,s.message("showLeaderBoard")},this.getGameStats=function(){var e={state:this.state,minesLeft:this.minesLeft,players:this.getPlayersData()};return e},this.containsUser=function(e){if(!e)return null;for(var t=0;t<this.users.length;++t)if(this.users[t]===e)return!0},this.getPlayer=function(e){if(!e)return null;for(var t=0;t<this.players.length;++t)if(this.players[t].id===e)return this.players[t]},this.getUser=function(e){if(!e)return null;for(var t=0;t<this.users.length;++t)if(this.users[t].id===e)return this.users[t]},this.getPlayersData=function(){for(var e=[],t=0;t<this.players.length;++t){var i=this.players[t];e.push({id:i.id,name:i.name,flag:i.flag,mineCount:i.mineCount,points:i.points,flaggedMiss:i.flaggedMiss,triggerMineCount:i.triggerMineCount,longestStreak:i.longestStreak,currentStreak:i.currentStreak,streakBonus:i.streakBonus,multiplier:i.multiplier,multiplier_max:i.multiplier_max,x:i.x,y:i.y})}return e},this.start=function(e,t){this.state="playing",this.startTime=Date.now(),this.populateMineGrid(this.mineGrid,this.mineCount,e,t),this.message("start",{x:e,y:t}),this.message("stateChanged","playing")},this.clearPlayerStats=function(e){e.mineCount=0,e.points=0,e.flaggedMiss=0,e.triggerMineCount=0,e.longestStreak=0,e.currentStreak=0,e.streakBonus=0,e.multiplier=1,e.multiplier_max=0},this.createGridEdge=function(e){for(var t=2,i=0;i<e.width;i+=1)for(var a=0;a<t;a+=1)e.set(i,a,MineCell.EDGE),e.set(i,e.height-1-a,MineCell.EDGE);for(var n=0;n<e.height;n+=1)for(var a=0;a<t;a+=1)e.set(a,n,MineCell.EDGE),e.set(e.width-1-a,n,MineCell.EDGE);return e},this.populateMineGrid=function(e,t,i,a){t>e.width*e.height&&(t=e.width*e.height-1);for(var n=0;n<t;){var s=Math.floor(Math.random()*e.width),o=Math.floor(Math.random()*e.height);e.get(s,o)!==MineCell.BOMB&&e.get(s,o)!==MineCell.EDGE&&("undefined"!=typeof i&&"undefined"!=typeof a&&Math.abs(s-i)<=1&&Math.abs(o-a)<=1||(e.set(s,o,MineCell.BOMB),n+=1))}for(var r=0;r<e.width;r+=1)for(var l=0;l<e.height;l+=1){var h=e.get(r,l);if(h!==MineCell.BOMB&&h!==MineCell.EDGE){for(var d=0,u=e.getNeighbors(r,l),g=0;g<u.length;g++){var m=e.get(u[g].x,u[g].y);
m===MineCell.BOMB&&(d+=1)}d>0&&e.set(r,l,d)}}if(this.message("populateMineGrid",e.width+","+e.height+","+t),this.debug===!0&&console.log){var c=this.printGrid(e);console.log(c)}},this.moveView=function(e,t,i){var a=this.getPlayer(i.id);a||(a=this.join(i)),e=Number(e),t=Number(t),a.viewX=e,a.viewY=t,this.message("moveView",{x:e,y:t},a)},this.placeFlag=function(e,t,i){var a=this.getPlayer(i.id);a||(a=this.join(i)),e=Number(e),t=Number(t),a.x=e,a.y=t,a.timeStamp=(new Date).getTime(),a.viewX=e,a.viewY=t,"pregame"===this.state&&this.start(e,t);var n=this.playGrid.get(e,t),s=this.mineGrid.get(e,t);n===MineCell.HIDDEN&&s===MineCell.BOMB&&this.flaggedMine(e,t,a),n===MineCell.HIDDEN&&s!==MineCell.BOMB&&this.flaggedMiss(e,t,a),this.checkForGameOver()},this.revealCell=function(e,t,i){var a=this.getPlayer(i.id);a||(a=this.join(i)),e=Number(e),t=Number(t),a.x=e,a.y=t,a.timeStamp=(new Date).getTime(),a.viewX=e,a.viewY=t,"pregame"===this.state&&this.start(e,t),this.message("revealCellStart");var n=[],s=this.playGrid.get(e,t),o=this.mineGrid.get(e,t);s===MineCell.HIDDEN?(o===MineCell.BLANK&&(n=this.revealBlanksFloodFill(e,t),this.message("revealCell",{x:e,y:t,value:o},a),this.revealPoints(e,t,n,a)),o===MineCell.BOMB?(this.playGrid.set(e,t,MineCell.BOMBHIT),n.push({x:e,y:t,value:MineCell.BOMBHIT}),this.triggerMine(e,t,a)):(this.playGrid.set(e,t,o),n.push({x:e,y:t,value:o}),this.message("revealCell",{x:e,y:t,value:o},a),this.revealPoints(e,t,n,a))):s!==MineCell.PROX1&&s!==MineCell.PROX2&&s!==MineCell.PROX3&&s!==MineCell.PROX4&&s!==MineCell.PROX5&&s!==MineCell.PROX6&&s!==MineCell.PROX7&&s!==MineCell.PROX8||(n=this.autoReveal(e,t),this.message("revealCell",{x:e,y:t,value:o},a),this.revealPoints(e,t,n,a)),this.message("cellChanged",n,a),this.checkForGameOver()},this.revealPoints=function(e,t,i,a){var n=0;if(i){var s=i.length;a&&(a.points<0&&(a.points=0),n=Math.min(s,3),a.points+=n),this.message("scoreChanged",{x:e,y:t,change:n,total:a.points},a)}},this.triggerMine=function(e,t,i){var a=0;this.minesLeft-=1,i&&(a=-1*(10*i.multiplier),i.points+=-1*(10*i.multiplier),i.triggerMineCount+=1,i.currentStreak=0,i.points<0&&(i.points=0),1!=i.multiplier&&(i.multiplier=1,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i))),this.message("triggerMine",{x:e,y:t,value:0},i),this.message("cellChanged",[{x:e,y:t,value:MineCell.BOMBHIT}],i),this.message("scoreChanged",{x:e,y:t,change:a,total:i.points},i)},this.flaggedMine=function(e,t,i){var a=MineCell.FLAG;i&&(i.flag&&(a=i.flag),i.mineCount+=1,i.currentStreak+=1,i.longestStreak=Math.max(i.longestStreak,i.currentStreak),i.currentStreak<3&&(i.multiplier=1),3===i.currentStreak&&(i.multiplier=2,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),6===i.currentStreak&&(i.multiplier=3,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),10===i.currentStreak&&(i.multiplier=4,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),15===i.currentStreak&&(i.multiplier=5,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),20===i.currentStreak&&(i.multiplier=6,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),30===i.currentStreak&&(i.multiplier=7,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),40===i.currentStreak&&(i.multiplier=8,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),60===i.currentStreak&&(i.multiplier=9,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),80===i.currentStreak&&(i.multiplier=10,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),200===i.currentStreak&&(i.multiplier=20,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i)),i.multiplier_max=Math.max(i.multiplier,i.multiplier_max||0),i.points=i.points+i.multiplier),this.playGrid.set(e,t,a),this.minesLeft-=1,this.message("flaggedMine",{x:e,y:t,value:a},i),this.message("cellChanged",[{x:e,y:t,value:a}],i),this.message("scoreChanged",{x:e,y:t,change:i.multiplier,total:i.points},i)},this.flaggedMiss=function(e,t,i){var a=0,n=this.mineGrid.get(e,t);this.playGrid.set(e,t,n),i&&(a=-1*i.multiplier,i.points=i.points-i.multiplier,i.flaggedMiss+=1,i.currentStreak=0,i.points<0&&(i.points=0),1!=i.multiplier&&(i.multiplier=1,this.message("multiplierChanged",{x:e,y:t,multiplier:i.multiplier},i))),this.message("flaggedMiss",{x:e,y:t,value:n},i),this.message("cellChanged",[{x:e,y:t,value:n}],i),this.message("scoreChanged",{x:e,y:t,change:a,total:i.points},i)},this.revealBlanksFloodFill=function(e,t){var i,a,n=this.mineGrid.data,s=this.playGrid.data,o=[],r=this.mineGrid.width,l=this.mineGrid.data.length,h=[],d=e+t*r,u=d,g=d,m=r,c=MineCell.HIDDEN;for(h.push(d);h.length;)if(d=h.pop(),s[d]===c&&n[d]===MineCell.BLANK){for(u=d,g=d,a=parseInt(d/m)*m,i=a+m-1;;){if(g<=a)break;if(s[g-1]!==c)break;if(n[g-1]!==MineCell.BLANK)break;g-=1}for(;;){if(u>=i)break;if(s[u+1]!==c)break;if(n[u+1]!==MineCell.BLANK)break;u+=1}g>a&&(s[g-1]=n[g-1],o.push({x:(g-1)%m,y:Math.floor((g-1)/m),value:s[g-1]})),u<i&&(s[u+1]=n[u+1],o.push({x:(u+1)%m,y:Math.floor((u+1)/m),value:s[u+1]}));for(var p=g;p<=u;p+=1){s[p]=n[p],o.push({x:p%m,y:Math.floor(p/m),value:s[p]});var f=0;f=p-m,p-m>=0&&s[f]===c&&n[f]===MineCell.BLANK&&h.push(f),f=p-m-1,f>=0&&s[f]===c&&n[f]===MineCell.BLANK&&f%l!==0&&h.push(f),f=p-m+1,f>=0&&s[f]===c&&n[f]===MineCell.BLANK&&f%l!==l&&h.push(f),f=p+m,f<l&&s[f]===c&&n[f]===MineCell.BLANK&&h.push(f),f=p+m-1,f<l&&s[f]===c&&n[f]===MineCell.BLANK%l!==0&&h.push(f),f=p+m+1,f<l&&s[f]===c&&n[f]===MineCell.BLANK%l!==l&&h.push(f);var y=0;y=p-m,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p+m,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p+1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p-1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p-m-1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p-m+1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p+m-1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]})),y=p+m+1,y>=0&&s[y]===c&&n[y]!==MineCell.BLANK&&n[y]!==MineCell.BOMB&&(s[y]=n[y],o.push({x:y%m,y:Math.floor(y/m),value:s[y]}))}}return o},this.autoReveal=function(e,t){for(var i=this.mineGrid.get(e,t),a=i,n=0,s=[],o=this.mineGrid.getNeighbors(e,t),r=0;r<o.length;r+=1){var l=o[r],h=this.mineGrid.get(l.x,l.y),d=this.playGrid.get(l.x,l.y);h===MineCell.BOMB&&d>=MineCell.FLAG&&(n+=1),h===MineCell.BOMB&&d===MineCell.BOMB&&(n+=1)}if(a===n)for(var r=0;r<o.length;r+=1){var l=o[r],h=this.mineGrid.get(l.x,l.y),d=this.playGrid.get(l.x,l.y);if(h===MineCell.BLANK){var u=this.revealBlanksFloodFill(l.x,l.y);s=s.concat(u)}h!==MineCell.BOMB&&d===MineCell.HIDDEN&&(this.playGrid.set(l.x,l.y,h),s.push({x:l.x,y:l.y,value:h}))}return s},this.checkForGameOver=function(){if(0===this.minesLeft&&this.gameOver(),this.singlePlayerRules&&this.players.length>0){var e=this.players[0];e.triggerMineCount&&e.triggerMineCount>0&&this.gameOver(),e.triggerMineCount&&e.triggerMineCount>0&&this.gameOver()}},this.gameOver=function(){"playing"===this.state&&(this.state="postgame",this.bootAllInactivePlayers(),this.message("gameOver",this.getElaspedTime()),this.message("stateChanged","gameOver"),0===this.minesLeft?this.message("gameOverWin",this.getElaspedTime()):this.message("gameOverLose",this.getElaspedTime()))},this.printGrid=function(e){for(var t="",i=0;i<e.height;i+=1){for(var a=0;a<e.width;a+=1){var n=e.get(a,i);t+=n+" "}t+="\n"}return t},this.bootAllInactivePlayers=function(){for(var e=[],t=0;t<s.users.length;t++){for(var i=s.users[t],a=!1,n=0;n<s.players.length;n++){var o=s.players[n];i.id===o.id&&(a=!0)}a||e.push(i)}for(var t=0;t<e.length;t++){var i=e[t];s.leave(i)}},this.findNearPlayer=function(e,t){var i=[];t||(t=20);for(var a=0;a<this.players.length;a++){var n=this.players[a];e&&n&&Math.abs(e.x-n.viewX)<t&&Math.abs(e.y-n.viewY)<t&&i.push(n)}return i}};"undefined"!=typeof module&&(module.exports=Minesweeper),MenuUI=function(e){},MenuUI.prototype={init:function(e){},preload:function(){this.game.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceLandscape=!1,this.game.scale.parentIsWindow=!0,this.game.scale.refresh(),this.load.path="assets/",this.load.bitmapFont("font/azo"),this.load.image("PlayButton","buttons/PlayButton.png"),this.load.spritesheet("AudioButton","buttons/AudioButton.png",40,40),this.load.image("BackButton","buttons/BackButton.png"),this.load.image("MenuButton","buttons/MenuButton.png"),this.load.image("Title_Minesweeper","Title_Minesweeper.png"),this.load.spritesheet("MenuButtons","buttons/MenuButtons.png",250,50),this.load.image("TileBackground","TileBackground.png")},create:function(){this.game.world.setBounds(0,0,this.game.length,2*this.game.height),this.stage.backgroundColor="#000000",background=this.game.add.tileSprite(0,0,this.game.width,this.game.height,"TileBackground"),background.x=-1,background.y=-1;var e=Math.floor(this.game.width/2);this.title=this.add.sprite(e,0,"Title_Minesweeper"),this.title.anchor.x=.5;var t;t=this.add.button(e,210,"MenuButtons",function(){this.playGame({width:128,height:128,mines:60})},this,0,0,0),t.anchor.set(.5),t=this.add.button(e,270,"MenuButtons",this.howToPlay,this,2,2,2),t.anchor.set(.5),this.buttonAudio=this.add.button(10,this.game.height-50,"AudioButton",this.toggleAudio,this,0,0,0),this.game.sound.mute===!0&&this.buttonAudio.setFrames(1,1,1)},newGame:function(e){this.game.state.start("LevelSelectUI",!0,!1)},playGame:function(e){this.game.state.remove("MinesweeperUI"),this.game.state.add("MinesweeperUI",MinesweeperUI),e?this.game.state.start("MinesweeperUI",!0,!1,e):this.game.state.start("MinesweeperUI",!0,!1,{width:10,height:15,mines:3})},howToPlay:function(){this.game.state.start("HowToPlayUI",!0,!1)},customGame:function(){},menu:function(){this.game.state.start("MenuUI",!0,!1)},toggleAudio:function(){this.game.sound.mute===!0?(this.game.sound.mute=!1,this.buttonAudio.setFrames(0,0,0)):(this.game.sound.mute=!0,this.buttonAudio.setFrames(1,1,1))}},LevelSelectUI=function(e){},LevelSelectUI.prototype={init:function(e){},preload:function(){this.game.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceLandscape=!1,this.game.scale.parentIsWindow=!0,this.game.scale.refresh(),this.load.path="assets/",this.load.bitmapFont("font/azo"),this.load.image("PlayButton","buttons/PlayButton.png"),this.load.image("BackButton","buttons/BackButton.png"),this.load.image("MenuButton","buttons/MenuButton.png"),this.load.image("Title_Minesweeper","Title_Minesweeper.png"),this.load.spritesheet("LevelButtons","buttons/LevelButtons.png",250,50),this.load.image("TileBackground","TileBackground.png")},create:function(){this.game.world.setBounds(0,0,this.game.length,2*this.game.height),this.stage.backgroundColor="#000000",background=this.game.add.tileSprite(0,0,this.game.width,this.game.height,"TileBackground"),background.x=-1,background.y=-1;var e=Math.floor(this.game.width/2),t=this.game.add.graphics(0,0);t.fixedToCamera=!0,t.beginFill(3355443),t.lineStyle(10,16767232,0),t.drawRect(0,0,this.game.width,60),this.buttonBack=this.game.add.button(10,10,"MenuButton",this.menu,this),this.buttonBack.width=40,this.buttonBack.height=40,this.buttonBack.fixedToCamera=!0;var i;i=this.add.button(e,140,"LevelButtons",function(){this.playGame({width:10,height:10,mines:8})},this,0,0,0),i.anchor.set(.5),i=this.add.button(e,200,"LevelButtons",function(){this.playGame({width:20,height:20,mines:60})},this,1,1,1),i.anchor.set(.5),i=this.add.button(e,260,"LevelButtons",function(){this.playGame({width:40,height:40,mines:250})},this,2,2,2),i.anchor.set(.5),i=this.add.button(e,320,"LevelButtons",function(){this.playGame({width:80,height:80,mines:999})},this,3,3,3),i.anchor.set(.5),i=this.add.button(e,380,"LevelButtons",function(){this.playGame({width:300,height:300,mines:9999})},this,4,4,4),i.anchor.set(.5)},playGame:function(e){this.game.state.remove("MinesweeperUI"),this.game.state.add("MinesweeperUI",MinesweeperUI),e?this.game.state.start("MinesweeperUI",!0,!1,e):this.game.state.start("MinesweeperUI",!0,!1,{width:10,height:15,mines:3})},customGame:function(){},menu:function(){this.game.state.start("MenuUI",!0,!1)}},MinesweeperUI=function(e){this.level=null,this.map=null,this.layer=null,this.minesweeper=null,this.marker=null,this.stageGroup=null,this.worldScale=1,this.cursors=null,this.textMineCount=null,this.textPoints=null,this.buttonSmile=null,this.menuLayer,this.gameLayer,this.flagMode=!1,this.miniMap=null,this.playerUIs=[],this.leaderboardTexts=[],this.TILE_SIZE=32,this.localUser=null;var t=this;this.init=function(e,t){this.localUser=t,this.localUser||(this.localUser={}),this.minesweeper=e,this.minesweeper||(this.minesweeper=new Minesweeper,this.minesweeper.init(60,60,50)),this.game.stage.disableVisibilityChange=!0},this.preload=function(){this.game.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceLandscape=!1,this.game.scale.parentIsWindow=!0,this.game.scale.refresh(),this.load.path="assets/",this.load.image("tiles","tilemaps/tiles/minesweeper-tiles-32-v3.png"),this.load.spritesheet("Flags","tilemaps/tiles/minesweeper-tiles-32-v3.png",32,32),this.load.spritesheet("buttonSmile","buttons/smile.png",40,40),this.load.image("BackButton","buttons/MenuButton.png"),this.load.image("MenuButton","buttons/MenuButton.png"),this.load.image("LeaderboardButton","buttons/LeaderboardButton.png"),this.load.spritesheet("FlagButton","buttons/FlagButton.png",40,40),this.load.spritesheet("MenuButtons","buttons/MenuButtons.png",250,50),this.load.spritesheet("PlayerSquares","sprites/PlayerSquares.png",32,32),this.load.audio("Click","audio/click1.wav"),this.load.audio("DblClick","audio/dbl-click.wav"),this.load.audio("Success","audio/171671__fins__success-1.wav"),this.load.audio("Explode","audio/80938__tony-b-kksm__soft-explosion.wav"),this.load.audio("Error","audio/button-10-error.wav"),this.load.audio("ClearBomb","audio/319200__18hiltc__pixel-game-beep.wav"),this.load.audio("Coin","audio/341695__projectsu012__coins-1.wav")},this.create=function(){this.stage.backgroundColor="#DDDDDD",this.Click=this.game.add.audio("Click"),this.DblClick=this.game.add.audio("DblClick"),this.Success=this.game.add.audio("Success"),this.Explode=this.game.add.audio("Explode"),this.Error=this.game.add.audio("Error"),this.ClearBomb=this.game.add.audio("ClearBomb"),this.Coin=this.game.add.audio("Coin");var e=this.minesweeper.playGrid,t=e.width,i=e.height;this.mapLayer=this.game.add.group(),this.generateGrid(),this.game.camera.focusOnXY(e.width*this.TILE_SIZE/2,0),this.playerLayer=this.game.add.group();var a=Math.floor(this.game.width/2),n=this.game.add.graphics(0,0);n.fixedToCamera=!0,n.beginFill(3355443),n.lineStyle(10,16767232,0),n.drawRect(0,0,this.game.width,60),n.beginFill(0),n.drawRect(a-75-20,10,75,40),n.beginFill(0),n.drawRect(a+20,10,75,40);var s={font:"32px Arial",fill:"#fff",boundsAlignH:"center",boundsAlignV:"middle"};this.textMineCount=this.game.add.text(0,0,"999",s),this.textMineCount.setTextBounds(a-75-20,15,75,40),this.textMineCount.fixedToCamera=!0,this.textPoints=this.game.add.text(0,0,"888",s),this.textPoints.setTextBounds(a+20,15,75,40),this.textPoints.fixedToCamera=!0,this.buttonSmile=this.game.add.button(a-20,10,"buttonSmile",this.reset,this,0,0,1,0),this.buttonSmile.fixedToCamera=!0,this.buttonBack=this.game.add.button(10,10,"MenuButton",this.menu,this),this.buttonBack.width=40,this.buttonBack.height=40,this.buttonBack.fixedToCamera=!0,this.buttonFlag=this.game.add.button(this.game.width-50,10,"FlagButton",this.changeFlagMode,this,0,0,1,0),this.buttonFlag.width=40,this.buttonFlag.height=40,this.buttonFlag.fixedToCamera=!0,this.leaderboardButton=this.game.add.button(this.game.width-100,10,"LeaderboardButton",this.testRedraw,this),this.leaderboardButton.width=40,this.leaderboardButton.height=40,this.leaderboardButton.fixedToCamera=!0,this.menuLayer=this.game.add.group(),this.menuLayer.add(n),this.menuLayer.add(this.textMineCount),this.menuLayer.add(this.textPoints),this.menuLayer.add(this.buttonSmile),this.menuLayer.add(this.buttonBack),this.menuLayer.add(this.buttonFlag),this.menuLayer.add(this.leaderboardButton);var o={font:"32px Arial",fill:"#fff",boundsAlignH:"center"},r=this.game.add.graphics(0,0);r.beginFill(3355443),r.drawRect(a-150,100,300,250),r.alpha=.9,r.fixedToCamera=!0,r.inputEnabled=!0,r.events.onInputDown.add(this.menu,this),this.textWin=this.game.add.text(0,0,"You win! \n\nTime: 123s \nMines: 30",o),this.textWin.setTextBounds(a-100,130,200,250),this.textWin.fixedToCamera=!0,this.winLayer=this.game.add.group(),this.winLayer.add(r),this.winLayer.add(this.textWin),this.winLayer.visible=!1;var l=this.game.add.graphics(0,0);l.beginFill(3355443),l.drawRect(a-150,100,300,250),l.alpha=.9,l.fixedToCamera=!0,l.inputEnabled=!0,l.events.onInputDown.add(this.menu,this),this.textLose=this.game.add.text(0,0,"You Lose\n\nTime: 123s \nMines: 30",o),this.textLose.setTextBounds(a-100,130,200,250),this.textLose.fixedToCamera=!0,this.loseLayer=this.game.add.group(),this.loseLayer.add(l),this.loseLayer.add(this.textLose),this.loseLayer.visible=!1,this.miniMapBackground=this.game.add.graphics(0,0),this.miniMapBackground.beginFill(0),this.miniMapBackground.drawRect(0,0,e.width,e.height),this.miniMapMask=this.game.add.graphics(0,0),this.miniMapMask.beginFill(0),this.miniMapMask.drawRect(0,0,e.width,e.height),this.miniMap=this.game.add.bitmapData(t,i),this.miniMap.smoothed=!1,this.miniMapSprite=this.game.add.sprite(0,0,this.miniMap),this.miniMapSprite.smoothed=!1,this.miniMapSprite.mask=this.miniMapMask,this.miniMapView=this.game.add.graphics(0,0),this.miniMapView.smoothed=!1,this.miniMapView.lineStyle(2,16711680,1),this.miniMapView.drawRect(0,0,Math.floor(this.game.camera.width/this.TILE_SIZE),Math.floor(this.game.camera.height/this.TILE_SIZE)),this.miniMapLayer=this.game.add.group(),this.miniMapLayer.add(this.miniMapBackground),this.miniMapLayer.add(this.miniMapMask),this.miniMapLayer.add(this.miniMapSprite),this.miniMapLayer.add(this.miniMapView),this.miniMapLayer.cameraOffset.x=this.game.width-e.width,this.miniMapLayer.cameraOffset.y=this.game.height-e.height,this.miniMapLayer.fixedToCamera=!0,this.leaderboardLayer=this.game.add.group();var h=this.game.width-120,d=60,u=120,g=130,m=20;this.leaderboardBackground=this.game.add.graphics(0,0),this.leaderboardBackground.beginFill(0),this.leaderboardBackground.alpha=.5,this.leaderboardBackground.drawRect(h,d,u,g),this.leaderboardBackground.fixedToCamera=!0,this.leaderboardLayer.add(this.leaderboardBackground),this.leaderboardTexts=[],this.leaderboardStyle={font:"14px Arial",fill:"#ffffff"},this.leaderboardHighlightedStyle={font:"14px Arial",fill:"#FFFF00"};for(var c=0;c<6;c++){var p=this.game.add.text(h+25,d+5+m*c,c+". ---------",this.leaderboardStyle);p.fixedToCamera=!0,this.leaderboardLayer.add(p),this.leaderboardTexts.push(p)}this.leaderboardFlags=[];for(var c=0;c<6;c++){var f=this.game.add.sprite(h+5,d+5+m*c,"Flags");f.width=16,f.height=16,f.frame=16,f.fixedToCamera=!0,this.leaderboardLayer.add(f),this.leaderboardFlags.push(f)}var y={font:"32px Arial",fill:"#fffffF",boundsAlignH:"center"};this.textWinPoints=this.game.add.text(0,0,"+5",y),this.textWinPoints.visible=!1;var v={font:"32px Arial",fill:"#ff0000",boundsAlignH:"center"};this.textLosePoints=this.game.add.text(0,0,"-5",v),this.textLosePoints.visible=!1;var w={font:"32px Arial",fill:"#00ff00",boundsAlignH:"center"};this.textSteakPoints=this.game.add.text(0,0,"+5",w),this.textSteakPoints.visible=!1,this.cursors=this.game.input.keyboard.createCursorKeys(),this.game.input.addMoveCallback(this.onMove,this),this.game.input.onTap.add(this.onTap,this),this.game.input.onHold.add(this.onHold,this),this.game.input.holdRate=350,this.game.input.onDown.add(this.onDown,this),this.game.input.onUp.add(this.onUp,this),this.game.input.mouse.mouseWheelCallback=this.onMouseWheel,this.game.onPause.add(this.onGamePause,this),this.game.onResume.add(this.onGameResume,this),this.minesweeper.getState(),this.refreshUI(),this.minesweeper.onMessage=this.onMessage},this.onGamePause=function(){console.log("onGamePause")},this.onGameResume=function(){console.log("onGameResume")},this.shutdown=function(){this.buttonFlag.destroy(),this.buttonSmile.destroy(),this.buttonBack.destroy(),this.leaderboardButton.destroy(),this.game.input.onTap.removeAll(),this.game.input.onHold.removeAll(),this.game.input.onDown.removeAll(),this.game.input.onUp.removeAll(),this.miniMap.destroy(),this.layer.destroy(),this.map.destroy(),this.map=null},this.update=function(){this.cursors.left.isDown?this.game.camera.x-=10:this.cursors.right.isDown&&(this.game.camera.x+=10),this.cursors.up.isDown?this.game.camera.y-=10:this.cursors.down.isDown&&(this.game.camera.y+=10),this.game.input.keyboard.isDown(Phaser.Keyboard.Q)?(this.game.camera.scale.x+=.05,this.game.camera.scale.y+=.05):this.game.input.keyboard.isDown(Phaser.Keyboard.A)&&(this.game.camera.scale.x-=.05,this.game.camera.scale.y-=.05),this.game.world.scale.set(this.worldScale)},this.render=function(){},this.moveCamera=function(e,t){this.game.camera.x=e,this.game.camera.y=t,this.miniMapView.x=this.game.camera.x/this.TILE_SIZE,this.miniMapView.y=this.game.camera.y/this.TILE_SIZE},this.onInputDownMiniMap=function(e,i){t.game.camera.x=i.x*t.TILE_SIZE,t.game.camera.y=i.y*t.TILE_SIZE,t.miniMapSprite.x=t.game.camera.x/t.TILE_SIZE,t.miniMapSprite.y=t.game.camera.y/t.TILE_SIZE},this.onMove=function(e,t,i,a){if(e.isDown){var n=10;if(this.startDown||(this.startDown={x:e.x,y:e.y}),!this.oldPosition&&Math.abs(this.startDown.x-e.position.x)<n&&!this.oldPosition&&Math.abs(this.startDown.y-e.position.y)<n)return;if(this.oldPosition){var s=this.game.camera.x+this.oldPosition.x-e.position.x,o=this.game.camera.y+this.oldPosition.y-e.position.y;this.moveCamera(s,o)}this.oldPosition=e.position.clone()}e.isUp&&(this.oldPosition=null)},this.onTap=function(e,t){},this.onHold=function(e,t){var i=10;if(!(this.startDown&&Math.abs(this.startDown.x-e.x)>i||this.startDown&&Math.abs(this.startDown.y-e.y)>i)){var a=this.layer.getTileX(this.game.input.activePointer.worldX),n=this.layer.getTileY(this.game.input.activePointer.worldY);this.minesweeper.placeFlag(a,n,this.localUser)}},this.onUp=function(e,i){var a=10;if(this.startDown&&Math.abs(this.startDown.x-e.x)<a&&this.startDown&&Math.abs(this.startDown.y-e.y)<a){var n=this.layer.getTileX(this.game.input.activePointer.worldX),s=this.layer.getTileY(this.game.input.activePointer.worldY);e.leftButton.isDown===!0?(t.minesweeper.flagMode===!1&&this.minesweeper.revealCell(n,s,this.localUser),t.minesweeper.flagMode===!0&&this.minesweeper.placeFlag(n,s,this.localUser)):e.rightButton.isDown===!0?this.minesweeper.placeFlag(n,s,this.localUser):(t.minesweeper.flagMode===!1&&this.minesweeper.revealCell(n,s,this.localUser),t.minesweeper.flagMode===!0&&this.minesweeper.placeFlag(n,s,this.localUser))}this.oldPosition=null,this.startDown=null;var o=Math.floor((this.game.camera.x+this.game.width/2)/t.TILE_SIZE),r=Math.floor((this.game.camera.y+this.game.height/2)/t.TILE_SIZE);this.minesweeper.moveView(o,r,this.localUser)},this.onDown=function(e,t){this.startDown={x:e.x,y:e.y}},this.onMouseWheel=function(e,t){},this.leftPad=function(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i},this.testRedraw=function(){this.minesweeper.init(),t.updateUI()},this.updateUI=function(){var e=t.minesweeper.playGrid,i=e.width,a=e.height;if(t.map&&0!==t.map.layers.length){try{for(var n=0;n<a;n++)for(var s=0;s<i;s++){var o=e.get(s,n),r=t.map.layers[0].data[n][s];r&&(r.index=o)}}catch(l){console.log("error")}t.map.layers[0].dirty=!0,t.updateUIMenu()}},this.updateUICells=function(e){if(e){var i=t.minesweeper.playGrid,a=e.length;if(t.map&&0!==t.map.layers.length){for(var n=0;n<a;n++){var s=e[n],o=i.get(s.x,s.y),r=t.map.layers[0].data[s.y][s.x];r&&(r.index=o)}t.map.layers[0].dirty=!0}}},this.updateMiniMapUI=function(){if(t.miniMap){for(var e=t.minesweeper.playGrid,i=e.width,a=e.height,n=0;n<a;n++)for(var s=0;s<i;s++){var o=e.get(s,n);10===o?t.miniMap.setPixel(s,n,0,0,0,!1):0===o?t.miniMap.setPixel(s,n,255,0,0,!1):o>=MineCell.FLAG?t.miniMap.setPixel(s,n,255,0,0,!1):o>=MineCell.EDGE?t.miniMap.setPixel(s,n,150,150,150,!1):10!==o&&t.miniMap.setPixel(s,n,255,255,255,!1)}t.miniMap.context.putImageData(t.miniMap.imageData,0,0),t.miniMap.dirty=!0}},this.updateMiniMapUICells=function(e){if(e&&t.miniMap){for(var i=t.minesweeper.playGrid,a=e.length,n=0;n<a;n++){var s=e[n],o=s.x,r=s.y,l=i.get(o,r);10===l?t.miniMap.setPixel(o,r,0,0,0,!1):0===l?t.miniMap.setPixel(o,r,255,0,0,!1):l>=MineCell.FLAG?t.miniMap.setPixel(o,r,255,0,0,!1):l>=MineCell.EDGE?t.miniMap.setPixel(o,r,150,150,150,!1):10!==l&&t.miniMap.setPixel(o,r,255,255,255,!1)}t.miniMap.context.putImageData(t.miniMap.imageData,0,0),t.miniMap.dirty=!0}},this.updateUIMenu=function(){var e=(t.minesweeper.flagCount,t.minesweeper.minesLeft),i=0,a=(t.minesweeper.state,t.minesweeper.getPlayer(t.localUser.id));a&&(i=a.points),t.textMineCount&&(t.textMineCount.text=e||0),t.textPoints&&(t.textPoints.text=i||0),t.buttonFlag&&t.buttonFlag.exists&&(t.minesweeper.flagMode?t.buttonFlag.setFrames(1,1,0):t.buttonFlag.setFrames(0,0,1))},this.scoreChangedUI=function(e){var i=e.change,a=e.x,n=e.y,s=a*t.TILE_SIZE+t.TILE_SIZE/2,o=n*t.TILE_SIZE-t.TILE_SIZE/2;if(i>0){t.textWinPoints.text="+"+i,t.textWinPoints.visible=!0,t.textWinPoints.alpha=1,t.textWinPoints.x=s,t.textWinPoints.y=o;t.add.tween(t.textWinPoints).to({y:o-20},2e3,Phaser.Easing.Exponential.Out,!0),t.add.tween(t.textWinPoints).to({alpha:0},2500,Phaser.Easing.Exponential.In,!0)}if(i<0){t.textLosePoints.text=i,t.textLosePoints.visible=!0,t.textLosePoints.alpha=1,t.textLosePoints.x=s,t.textLosePoints.y=o;t.add.tween(t.textLosePoints).to({y:o-20},2e3,Phaser.Easing.Exponential.Out,!0),t.add.tween(t.textLosePoints).to({alpha:0},2500,Phaser.Easing.Exponential.In,!0)}t.textPoints&&(t.textPoints.text=e.total)},this.streakBonusUI=function(e){var i=e.change,a=e.x,n=e.y,s=a*t.TILE_SIZE+t.TILE_SIZE/2,o=n*t.TILE_SIZE-t.TILE_SIZE/2;if(i>0){t.textSteakPoints.text="+"+i,t.textSteakPoints.visible=!0,t.textSteakPoints.alpha=1,t.textSteakPoints.x=s,t.textSteakPoints.y=o;t.add.tween(t.textSteakPoints).to({y:o-20},2e3,Phaser.Easing.Exponential.Out,!0),t.add.tween(t.textSteakPoints).to({alpha:0},1700,Phaser.Easing.Exponential.In,!0)}t.textPoints&&(t.textPoints.text=e.total)},this.cleanupAllPlayerPositionUI=function(){for(var e=0;e<t.playerUIs.length;e++){var i=t.playerUIs[e];i.destroy()}t.playerUIs=[]},this.updateAllPlayerPositionUI=function(){if(t.playerLayer)for(var e=0;e<t.minesweeper.players.length;e++){for(var i=t.minesweeper.players[e],a=null,n=0;n<t.playerUIs.length;n++){var s=t.playerUIs[n];s.id===i.id&&(a=s)}a||(a=t.game.add.sprite(0,0,"PlayerSquares"),a.frame=i.id%14,a.id=i.id,t.playerLayer.add(a),t.playerUIs.push(a)),a.x=i.x*t.TILE_SIZE,a.y=i.y*t.TILE_SIZE}},this.updatePlayerPositionUI2=function(e){if(t.playerLayer){for(var i=null,a=0;a<t.playerUIs.length;a++){var n=t.playerUIs[a];n.id===e.flag&&(i=n)}i||(i=t.game.add.sprite(0,0,"PlayerSquares"),i.frame=e.flag%14,i.id=e.flag,t.playerLayer.add(i),t.playerUIs.push(i)),i.x=e.x*t.TILE_SIZE,i.y=e.y*t.TILE_SIZE}},this.updatePlayerPositionUI=function(e){if(t.playerLayer){for(var i=null,a=0;a<t.playerUIs.length;a++){var n=t.playerUIs[a];n.id===e.id&&(i=n)}i||(i=t.game.add.sprite(0,0,"PlayerSquares"),i.frame=e.id%14,i.id=e.id,t.playerLayer.add(i),t.playerUIs.push(i)),i.x=e.x*t.TILE_SIZE,i.y=e.y*t.TILE_SIZE}},this.leaderboardUI=function(e){if(this.leaderboardTexts&&0!==this.leaderboardTexts.length){this.leaderboardLayer&&(this.leaderboardLayer.visible=t.minesweeper.showLeaderboard);for(var i=t.minesweeper.players.sort(function(e,t){return t.points-e.points}),a=0;a<this.leaderboardTexts.length;a++){var n=this.leaderboardTexts[a];n.text="",n.setStyle(this.leaderboardStyle)}for(var s=!1,a=0;a<i.length&&a<this.leaderboardTexts.length;a++){var o=t.minesweeper.players[a],n=this.leaderboardTexts[a];o.name||"---------";n.text=a+1+"."+o.name,t.localUser.id&&o.id===t.localUser.id&&(s=!0,n.setStyle(this.leaderboardHighlightedStyle));var r=this.leaderboardFlags[a];r.frame=o.flag}if(s===!1)for(var a=0;a<i.length;a++){var o=t.minesweeper.players[a];if(t.localUser.id&&o.id===t.localUser.id){var n=this.leaderboardTexts[this.leaderboardTexts.length-1];n&&(n.text=a+1+"."+o.name,n.setStyle(this.leaderboardHighlightedStyle));var r=this.leaderboardFlags[this.leaderboardTexts.length-1];r.frame=o.flag}}}},this.refreshUI=function(){t.updateUI(),t.updateMiniMapUI(),t.updateUIMenu(),t.cleanupAllPlayerPositionUI(),t.updateAllPlayerPositionUI(),t.leaderboardUI()},this.onMessage=function(e,i,a){"cellChanged"===e&&(t.updateUICells(i),t.updateMiniMapUICells(i)),"gameOverLose"===e&&t.gameOverLose(),"gameOverWin"===e&&t.gameOverWin(),"flaggedMine"===e&&t.ClearBomb.play(),"flaggedMiss"===e&&t.Error.play(),"revealCell"===e&&t.Click.play(),"triggerMine"===e&&t.Explode.play(),"fullGameState"===e&&t.refreshUI(),"fullPlayGrid"===e&&t.generateGrid(),"join"===e&&t.refreshUI(),"gameStats"===e&&(t.updateUIMenu(),t.leaderboardUI()),"scoreChanged"===e&&t.scoreChangedUI(i),"streakBonus"===e&&(t.streakBonusUI(i),t.Coin.play()),"multiplierChanged"===e&&(t.updateUIMenu(),t.minesweeper.multiplier>1&&t.Coin.play()),"playerData"===e&&(t.updatePlayerPositionUI(i),t.leaderboardUI()),"pause"===e&&(t.game.paused=!0),"resume"===e&&(t.game.paused=!1),"showLeaderBoard"===e&&t.leaderboardUI()},this.generateGrid=function(){var e=this.minesweeper.playGrid,t=e.width,i=e.height;this.map||(this.map=this.game.add.tilemap(),this.map.addTilesetImage("tiles","tiles",32,32),this.layer=this.map.create("minefield",t,i,32,32),this.mapLayer.add(this.layer),this.layer.resizeWorld()),this.map.layers.length>0&&(this.map.layers[0].width===t&&this.map.layers[0].height===i||(this.layer&&this.layer.destroy(),this.map.removeAllLayers(),this.layer=this.map.create("minefield",t,i,32,32),this.mapLayer.add(this.layer),this.layer.resizeWorld()))},this.menu=function(){this.minesweeper.onMessage=null,this.minesweeper.leave(t.localUser.id),this.game.state.start("MenuUI",!0,!1)},this.reset=function(){this.minesweeper.reset()},this.changeFlagMode=function(){t.generateGrid(),t.minesweeper.flagMode=!t.minesweeper.flagMode,this.updateUIMenu()},this.gameOverLose=function(){this.updateUIMenu(),this.Explode.play();var e=0,i=0,a=Math.floor(this.minesweeper.getElaspedTime()),n=t.minesweeper.getPlayer(t.localUser.id);n&&(e=n.points,i=n.mineCount),this.textLose.text="You Lose!\n\nTime: "+a+"s \nMines: "+i+"s \nPoints: "+e,this.loseLayer.visible=!0},this.gameOverWin=function(){this.updateUIMenu(),this.Success.play();var e=0,i=0,a=Math.floor(this.minesweeper.getElaspedTime()),n=t.minesweeper.getPlayer(t.localUser.id);n&&(e=n.points,i=n.mineCount),this.textWin.text="You Win!\n\nTime:  "+a+"s \nMines: "+i+"s \nPoints: "+e,this.winLayer.visible=!0},this.refresh=function(){this.minesweeper.getState()}},HowToPlayUI=function(e){},HowToPlayUI.prototype={init:function(e){},preload:function(){this.game.scale.scaleMode=Phaser.ScaleManager.RESIZE,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceLandscape=!1,this.game.scale.parentIsWindow=!0,this.game.scale.refresh(),this.load.path="assets/",this.load.bitmapFont("font/azo"),this.load.image("BackButton","buttons/BackButton.png"),this.load.image("MenuButton","buttons/MenuButton.png"),
this.load.image("HowToPlay","HowToPlay.png"),this.load.spritesheet("LevelButtons","buttons/LevelButtons.png",250,50),this.load.image("TileBackground","TileBackground.png")},create:function(){this.game.world.setBounds(0,0,this.game.length,2*this.game.height),this.stage.backgroundColor="#ffffff";var e=Math.floor(this.game.width/2),t=this.game.add.graphics(0,0);t.fixedToCamera=!0,t.beginFill(3355443),t.lineStyle(10,16767232,0),t.drawRect(0,0,this.game.width,60),this.buttonBack=this.game.add.button(10,10,"MenuButton",this.menu,this),this.buttonBack.width=40,this.buttonBack.height=40,this.buttonBack.fixedToCamera=!0;var i=this.game.add.sprite(e,60,"HowToPlay");i.anchor.x=.5},menu:function(){this.game.state.start("MenuUI",!0,!1)}},AppController=function(){this.game=null,this.appName="Minesweeper.io",this.version="1.3.8",this.serverUrl="wss://minesweeper.io";var e=64;this.minesweeper=new Minesweeper(null,e,e,e*e/7),this.minesweeper.init(),this.user=null,this.adPlayer=null;var t=this;this.init=function(){Config&&Config.serverUrl&&(t.serverUrl=Config.serverUrl),Config&&Config.appName&&(t.appName=Config.appName),Config&&Config.version&&(t.version=Config.version),"undefined"!=typeof FBInstantGame&&FBInstantGame.onLoaded(t),AnalyticsGA.TrackStart("Minesweeper.io",t.version,"UA-43146845-17"),AnalyticsJI.TrackStart(t.appName,t.version),t.user=Storage.load("user")||new User,t.minesweeper.onMessage2=t.onMessage,Achievement.onNewAchievement=t.showAchievementPopup,t.createGameUI(),t.checkForFacebookAutoLogin(),t.showPage("menu")},this.hashchange=function(e){Storage.save("user",t.user);var i=location.hash;return""===i?void t.showPage("menu"):"#/"===i?void t.showPage("menu"):"#/menu"===i?void t.showPage("menu"):"#/game"===i?void t.startGame():"#/flags"===i?void t.showPage("flags"):0===i.lastIndexOf("#/login",0)?void t.showPage("login"):"#/howtoplay"===i?void t.showPage("howtoplay"):"#/profile"===i?void t.showPage("profile"):"#/settings"===i?void t.showPage("settings"):"#/winflag"===i?void t.showPage("winflag"):"#/achievements"===i?void t.showPage("achievements"):"#/gameover"===i?void t.showPage("gameover"):"#/levelselect"===i?void t.showPage("levelselect"):void t.showPage("menu")},this.onMessage=function(e,i,a){if("leave"===e&&t.showPage("menu"),"gameOver"===e){var n=t.minesweeper.getPlayer(t.minesweeper.localPlayerId);if(n){t.user.exp+=n.points||0,t.user.mineCount_total+=n.mineCount||0,t.user.flaggedMiss_total+=n.flaggedMiss||0,t.user.triggerMine_total+=n.triggerMineCount||0,t.user.longestStreak=Math.max(n.longestStreak||0,t.user.longestStreak||0),t.user.multiplier_max=Math.max(n.multiplier_max||0,t.user.multiplier_max||0),0===t.minesweeper.minesLeft&&(t.user.gamesPlayed=(t.user.gamesPlayed||0)+1);t.user.level;Level.checkLevel(t.user);Achievement.checkForAchievementAndReward(t.user)}}if("scoreChanged"===e){var n=t.minesweeper.getPlayer(t.user.id);if(n){var s=document.getElementById("gameMenu_Points");s.innerHTML=n.points}}if("multiplierChanged"===e){var n=t.minesweeper.getPlayer(t.user.id);if(n){var o=document.getElementById("gameMenu_Multiplier");o.innerHTML=n.multiplier}}if("fullGameState"===e){var n=t.minesweeper.getPlayer(t.user.id);if(n){var s=document.getElementById("gameMenu_Points");s.innerHTML=n.points;var o=document.getElementById("gameMenu_Multiplier");o.innerHTML=n.multiplier}}if("gameStats"===e){var n=t.minesweeper.getPlayer(t.user.id);if(n){var s=document.getElementById("gameMenu_Points");s.innerHTML=n.points;var o=document.getElementById("gameMenu_Multiplier");o.innerHTML=n.multiplier}}if("stateChanged"===e&&("pregame"===i&&(t.showPage("game"),console.log("--------pregame--------")),"playing"===i&&(t.showPage("game"),console.log("--------playing--------")),"postgame"===i&&(t.singlePlayerRules||(t.showPage("gameover"),t.adPlayer&&t.adPlayer.tryShowAd()),console.log("--------postgame--------"))),"restarting"===e){var r=document.getElementById("countDown");r&&(document.getElementById("countDown").innerText=i)}},this.showPage=function(e){if(AnalyticsGA.TrackPage(e),document.getElementById("menuPage").style.width="0%",document.getElementById("loginPage").style.width="0%",document.getElementById("flagsPage").style.width="0%",document.getElementById("endGamePage").style.width="0%",document.getElementById("howToPlayPage").style.width="0%",document.getElementById("gamePage").style.width="0%",document.getElementById("profilePage").style.width="0%",document.getElementById("settingsPage").style.width="0%",document.getElementById("winflag").style.width="0%",document.getElementById("achievementsPage").style.width="0%",document.getElementById("levelSelectPage").style.width="0%",t.game&&t.game.isRunning&&(t.game.paused=!0),document.getElementById("game").className="hideGame","login"===e){document.getElementById("loginPage").style.width="100%";var i=location.hash;if(i.startsWith("#/login/")){var a=i.match(/#\/login\/(.*)/);if(a){var n=a[1];"autologin"!==n&&Facebook.getInfo(n,function(e){t.user.name=e.first_name,t.user.email=e.email,t.user.avatar="https://graph.facebook.com/"+e.id+"/picture?type=normal",t.user.facebookid=e.id,t.user.accessToken=e.accessToken,t.showPage("menu")}),"autologin"===n&&t.loginFacebook()}}}if("levelselect"===e&&(document.getElementById("levelSelectPage").style.width="100%"),"menu"===e){t.minesweeper.leave(),t.game&&t.game.state.start("MenuUI",!0,!1),location.hash="#/menu",document.getElementById("menuPage").style.width="100%",Level.checkLevel(t.user);var s=document.getElementById("txtUserName");s.value=t.user.name;var o=document.getElementById("user_userName");o.innerHTML=t.user.name||"No Name";var r=document.getElementById("user_avatar");r.src=t.user.avatar;var l=document.getElementById("user_gold");l.innerHTML=t.user.gold;var h=document.getElementById("user_level");h.innerHTML=t.user.level;var d=document.getElementById("user_expForLevel");d.innerHTML=t.user.expForLevel;var u=document.getElementById("user_expToNextlevel");u.innerHTML=t.user.expToNextlevel;var g=document.getElementById("user_levelProgress"),m=t.user.expForLevel/t.user.expToNextlevel*100;g.style.width=m+"%";var c=t.user.achievements?t.user.achievements.length:0,p=Achievement.allAchievements?Achievement.allAchievements.length:1,f=document.getElementById("user_achievementCount");f.innerHTML=c;var y=document.getElementById("user_achievementTotalCount");y.innerHTML=p;var v=document.getElementById("user_achievementProgress"),w=c/p*100;v.style.width=w+"%";var M=document.getElementById("imgSelectedFlag");M.className="flag flag_"+t.user.flag}if("achievements"===e){document.getElementById("achievementsPage").style.width="100%";for(var C=document.getElementById("achievementsPage_achievementList");C.firstChild;)C.removeChild(C.firstChild);for(var P=Achievement.allAchievements,I=0;I<P.length;I++){var x=P[I],b=t.user.achievements.indexOf(x.Name)!==-1,k=document.createElement("li");b||(k.className="NotFound");var B=document.createElement("img");B.src="images/Achievements/"+x.Image;var S=document.createElement("div");S.className="points",S.innerHTML=x.Points;var A=document.createElement("div");A.className="title",A.innerHTML=x.Title;var T=document.createElement("div");T.className="description",T.innerHTML=x.Description,k.appendChild(B),k.appendChild(S),k.appendChild(A),k.appendChild(T),C.appendChild(k)}}if("winflag"===e){document.getElementById("winflag").style.width="100%";var L=document.getElementById("divWinflag");L.classList.remove("explodeAnimate")}if("profile"===e){document.getElementById("profilePage").style.width="100%";var E=document.getElementById("profilePage_txtUserName");E.value=t.user.name;var F=document.getElementById("profilePage_txtUserEmail");F.value=t.user.email||null;var G=document.getElementById("profile_exp");G.innerHTML=t.user.exp;var D=document.getElementById("profile_mineCount_total");D.innerHTML=t.user.mineCount_total;var N=document.getElementById("profile_flaggedMiss_total");N.innerHTML=t.user.flaggedMiss_total;var U=document.getElementById("profile_triggerMine_total");U.innerHTML=t.user.triggerMine_total;var O=document.getElementById("profile_longestStreak");O.innerHTML=t.user.longestStreak;var _=document.getElementById("profile_multiplier_max");_.innerHTML=t.user.multiplier_max;var R=document.getElementById("profile_gamesPlayed");R.innerHTML=t.user.gamesPlayed}if("settings"===e&&(document.getElementById("settingsPage").style.width="100%"),"flags"===e){document.getElementById("flagsPage").style.width="100%";for(var H=t.user.flags,W=document.querySelectorAll("#flagsPage .flag"),I=0;I<W.length;I++){var K=W[I];H.indexOf(Number(K.dataset.flagid))!==-1?K.classList.remove("disabled"):K.classList.add("disabled")}}if("howtoplay"===e&&(document.getElementById("howToPlayPage").style.width="100%"),e.indexOf("game")>-1){if(document.getElementById("gamePage").style.width="100%",document.getElementById("game").className="showGame",!t.user.hasSeenHowToPlay){t.user.hasSeenHowToPlay=!0;var V=document.getElementById("howToPlayPopUp");V.style.display="block"}t.game&&(t.game.paused=!1)}if("gameover"===e){document.getElementById("endGamePage").style.width="100%";var Z=t.minesweeper.getPlayer(t.minesweeper.localPlayerId);if(Z){var j=document.getElementById("mineCount");j.innerHTML=Z.mineCount;var S=document.getElementById("points");S.innerHTML=Z.points;var X=document.getElementById("flaggedMiss");X.innerHTML=Z.flaggedMiss;var J=document.getElementById("triggerMineCount");J.innerHTML=Z.triggerMineCount;var z=document.getElementById("longestStreak");z.innerHTML=Z.longestStreak}for(var q=document.getElementById("tblLeaderboard"),Y=t.minesweeper.players.sort(function(e,t){return t.points-e.points}),Q=q.rows.length,I=1;I<Q;I++)q.deleteRow(1);for(var I=0;I<Y.length;I++){var $=Y[I],ee=q.insertRow(-1);Z&&Z.id===$.id&&(ee.className="highlighted");var te=ee.insertCell(0),ie=ee.insertCell(1),ae=ee.insertCell(2);te.innerHTML=I+1,ie.innerHTML=$.name,ae.innerHTML=$.points}}},this.checkForFacebookAutoLogin=function(){var e=location.hash;if(e.startsWith("#/login/")){var i=e.match(/#\/login\/(.*)/);if(i){var a=i[1];"autologin"!==a&&Facebook.getInfo(a,function(e){t.user.name=e.first_name,t.user.email=e.email,t.user.avatar="https://graph.facebook.com/"+e.id+"/picture?type=normal",t.user.facebookid=e.id,t.user.accessToken=e.accessToken,t.showPage("menu")}),"autologin"===a&&t.loginFacebook()}}},this.showAchievementPopup=function(e){var t=document.getElementById("achievementPopup");t.classList.remove("showAchievementPopup"),void t.offsetWidth,t.classList.add("showAchievementPopup");var i=document.getElementById("achievementPopup_achievementList");if(e){for(;i.firstChild;)i.removeChild(i.firstChild);for(var a=0;a<e.length;a++){var n=e[a],s=document.createElement("li"),o=document.createElement("img");o.src="images/Achievements/"+n.Image;var r=document.createElement("div");r.className="title",r.innerHTML=n.Title;var l=document.createElement("div");l.className="description",l.innerHTML=n.Description,s.appendChild(o),s.appendChild(r),s.appendChild(l),i.appendChild(s)}}},this.createGameUI=function(){var e=Phaser.CANVAS,i=navigator.userAgent.match(/iemobile/i);i&&(e=Phaser.CANVAS),"canvas"===localStorage.renderMethod&&(e=Phaser.CANVAS),"auto"===localStorage.renderMethod&&(e=Phaser.AUTO),"webgl"===localStorage.renderMethod&&(e=Phaser.WEBGL),t.game=new Phaser.Game("100%","100%",e,"game",null,(!1),(!0)),t.game.state.add("MenuUI",MenuUI),t.game.state.add("MinesweeperUI",MinesweeperUI),t.game.state.start("MenuUI")},this.leaveGame=function(){t.showPage("menu"),t.minesweeper.leave()},this.updateName=function(e){e&&(t.user.name=e.value)},this.startClassicGame=function(e){e||(e=64);var i=t.user,a=document.getElementById("txtUserName").value;a&&(i.name=a),t.minesweeper.destroy(),t.minesweeper=new Minesweeper("Classic64x64",e,e,e*e/6),t.minesweeper.init(),t.minesweeper.showLeaderboard=!1,t.minesweeper.singlePlayerRules=!0,t.minesweeper.onMessage2=t.onMessage;var n=new PlayerLocal(i.id,i.name,i.flag);t.minesweeper.join(n),t.minesweeper.localPlayerId=n.id,t.game.state.start("MinesweeperUI",!0,!0,t.minesweeper,n),t.showPage("game/classic/"+e)},this.playGoogleAd=function(){},this.startGame=function(e){t.adPlayer&&t.adPlayer.tryShowAd(),e||(e=64);var i=t.user,a=document.getElementById("txtUserName").value;a&&(i.name=a),t.minesweeper.destroy();var n=t.serverUrl,s=document.getElementById("ddlServerUrl");if(s){var o=s.options[s.selectedIndex].value;o&&(n=o)}t.minesweeper=new MinesweeperProxy("Online",e,e,e*e/6,n),t.minesweeper.showLeaderboard=!0,t.minesweeper.singlePlayerRules=!1,t.minesweeper.init().then(function(){t.minesweeper.onMessage2=t.onMessage;var e=new PlayerLocal(i.id,i.name,i.flag);t.minesweeper.join(e),t.minesweeper.localPlayerId=e.id,t.game.state.start("MinesweeperUI",!0,!0,t.minesweeper,e),t.showPage("game")})["catch"](function(e){console.error(e)})},this.buySet=function(e){alert("Purchasing sets are disabled at this time")},this.shareToUnlockFlags=function(e){"twitter"===e?t.shareOnTwitter():t.shareOnFacebook();for(var i=64;i<80;i++)t.user.flags.push(i);t.showPage("menu")},this.selectFlag=function(e,i){var a=t.user.flags;if(a.indexOf(e)===-1){if(!i)return void alert("This flag is locked");if(t.user.gold<i)return void alert("You do not have enough coins.");var n=confirm("Would you like to buy the flag for "+i+" coins?");n&&(t.user.gold-=i,t.user.flags.push(e),t.showPage("flags"))}else t.user.flag=e,t.showPage("menu")},this.winNewFlag=function(){if(t.user.gold||(t.user.gold=0),t.user.gold<100)return void alert("You do not have enough coins.");t.user.gold-=100;var e=MineCell.FLAG,i=65,a=e+Math.floor(Math.random()*(i-e));t.user.flags.push(a);var n=document.getElementById("newFlag");n.className="flag flag_"+a,n.onclick=t.selectFlag.bind(this,a);var s=document.getElementById("divWinflag");s.classList.add("explodeAnimate")},this.flagModeToggle=function(){t.flagMode=!t.flagMode;var e=document.getElementById("flagMode");t.flagMode&&e.classList.add("flagButtonPressed"),t.flagMode||e.classList.remove("flagButtonPressed"),t.minesweeper&&(t.minesweeper.flagMode=t.flagMode)},this.leaderboardToggle=function(){t.minesweeper.leaderboardToggle()},this.earnCoins=function(){t.user.gold||(t.user.gold=0),t.user.gold+=75,t.showPage("menu")},this.shareOnFacebook=function(){return"undefined"!=typeof FBInstantGame?void FBInstantGame.shareFBInstant():(t.user.hasShared=!0,Achievement.rewardAchievement(t.user,"Share On Facebook"),t.showPage("menu"),void window.open("https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fminesweeper.io&display=popup&ref=plugin&src=share_button","_system","height=550,width=525,left=100,top=100,menubar=0"))},this.shareOnTwitter=function(){t.user.hasShared=!0,Achievement.rewardAchievement(t.user,"Share On Twitter"),t.showPage("menu"),window.open("https://twitter.com/share?url=http%3A%2F%2Fminesweeper.io&related=&hashtags=minesweeper%2Ciogames&text=minesweeper.io%20-%20Multiplayer%20Minesweeper","_blank")},this.loginFacebook=function(){Facebook.loginFacebook(function(e){t.user.name=e.first_name,t.user.email=e.email,t.user.avatar="https://graph.facebook.com/"+e.id+"/picture?type=normal",t.user.facebookid=e.id,t.user.accessToken=e.accessToken,window.location.href="#/"})},this.openMoreGame=function(e,t){AnalyticsGA.TrackEvent("MoreGameIcons",t),e=encodeURI(e),window.open(e,"_system","location=yes")},this.openMoreGameFB=function(e){if(AnalyticsGA.TrackPage("MoreGames/"+e),"undefinded"!=typeof FBInstant){var t="1264960130273679";"Cribbage"==e&&(t="1264960130273679"),"Speed"==e&&(t="231387497434707"),FBInstant.switchGameAsync(t)["catch"](function(e){console.log("FBInstant.switchGameAsync: Error: "+JSON.stringify(e))})}}};var appController=null;window.addEventListener("DOMContentLoaded",function(){appController=new AppController,appController.init(),window.addEventListener("hashchange",appController.hashchange)},!1),window.onbeforeunload=function(e){},document.addEventListener("deviceready",function(){console.log("------deviceready--------"),"undefined"!=typeof navigator.splashscreen&&navigator.splashscreen.hide(),"undefined"!=typeof StatusBar&&StatusBar.hide(),"undefined"!=typeof navigator.notification&&(window.alert=navigator.notification.alert),"undefined"!=typeof cordova&&"undefined"!=typeof cordova.InAppBrowser&&(window.open=cordova.InAppBrowser.open)},!1);var Config={appName:"Minesweeper.io",version:"2.0.0",serverUrl:"wss://minesweeper.io",fullVersion:!1,showErrors:!1,showAppLinks:!1,debugMode:!1,facebookAddId:0x8fff94809caa,showMoreGames:!0};Adinplay=function(){function e(){"undefined"!=typeof aipPlayer&&(adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:!0,PREROLL_ELEM:document.getElementById("preroll"),AIP_COMPLETE:function(){},AIP_REMOVE:function(){}}))}function t(e,t){var i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("script"),n=!0;a.async="async",a.type="text/javascript",a.charset="UTF-8",a.src=e,a.onload=a.onreadystatechange=function(){!n||a.readyState&&!/loaded|complete/.test(a.readyState)||(n=!1,t(),a.onload=a.onreadystatechange=null)},i.appendChild(a)}this.tryShowAdCount=null,this.tryShowAdFirstLoad=!0;var i=this;this.tryShowAd=function(){if(null===i.tryShowAdCount){var e=sessionStorage.getItem("tryShowAdCount");i.tryShowAdCount=e||0,i.tryShowAdCount=Number(i.tryShowAdCount)}1===i.tryShowAdCount?i.playAd():i.tryShowAdCount>1&&i.tryShowAdCount%6===0?i.playAd():i.tryShowAdCount>1&&i.tryShowAdFirstLoad===!0&&this.playAd(),i.tryShowAdCount=i.tryShowAdCount+1,sessionStorage.setItem("tryShowAdCount",i.tryShowAdCount),i.tryShowAdFirstLoad=!1},this.playAd=function(){"undefined"!=typeof adplayer&&adplayer.startPreRoll()},t("//api.adinplay.com/player/v2/JDSF/minesweeper.io/player.min.js",e)};