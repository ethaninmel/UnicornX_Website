var cookiename = "pedaily.cn";
/*!
* headroom.js v0.7.0 - Give your page some headroom. Hide your header until you need it
* Copyright (c) 2014 Nick Williams - http://wicky.nillia.ms/headroom.js
* License: MIT
*/
(function(window, document) {

    "use strict";

    /* exported features */

    var features = {
        bind: !!(function() {}.bind),
        classList: "classList" in document.documentElement,
        rAF: !!(window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame)
    };
    window.requestAnimationFrame = window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame;

    /**
     * Handles debouncing of events via requestAnimationFrame
     * @see http://www.html5rocks.com/en/tutorials/speed/animations/
     * @param {Function} callback The callback to handle whichever event
     */
    function Debouncer(callback) {
        this.callback = callback;
        this.ticking = false;
    }

    Debouncer.prototype = {
        constructor: Debouncer,

        /**
         * dispatches the event to the supplied callback
         * @private
         */
        update: function() {
            this.callback && this.callback();
            this.ticking = false;
        },

        /**
         * ensures events don't get stacked
         * @private
         */
        requestTick: function() {
            if (!this.ticking) {
                requestAnimationFrame(this.rafCallback || (this.rafCallback = this.update.bind(this)));
                this.ticking = true;
            }
        },

        /**
         * Attach this as the event listeners
         */
        handleEvent: function() {
            this.requestTick();
        }
    };

    /**
     * Check if object is part of the DOM
     * @constructor
     * @param {Object} obj element to check
     */
    function isDOMElement(obj) {
        return obj && typeof window !== "undefined" && (obj === window || obj.nodeType);
    }

    /**
     * Helper function for extending objects
     */
    function extend(object /*, objectN ... */) {
        if (arguments.length <= 0) {
            throw new Error("Missing arguments in extend function");
        }

        var result = object || {},
            key,
            i;

        for (i = 1; i < arguments.length; i++) {
            var replacement = arguments[i] || {};

            for (key in replacement) {
                // Recurse into object except if the object is a DOM element
                if (typeof result[key] === "object" && ! isDOMElement(result[key])) {
                    result[key] = extend(result[key], replacement[key]);
                } else {
                    result[key] = result[key] || replacement[key];
                }
            }
        }

        return result;
    }

    /**
     * Helper function for normalizing tolerance option to object format
     */
    function normalizeTolerance(t) {
        return t === Object(t) ? t : { down: t, up: t };
    }

    /**
     * UI enhancement for fixed headers.
     * Hides header when scrolling down
     * Shows header when scrolling up
     * @constructor
     * @param {DOMElement} elem the header element
     * @param {Object} options options for the widget
     */
    function Headroom(elem, options) {

        options = extend(options, Headroom.options);

        this.lastKnownScrollY = 0;
        this.elem = elem;
        if (this.update.bind) {
            this.debouncer = new Debouncer(this.update.bind(this));
        }
        this.tolerance = normalizeTolerance(options.tolerance);
        this.classes = options.classes;
        this.offset = options.offset;
        this.scroller = options.scroller;
        this.initialised = false;
        this.onPin = options.onPin;
        this.onUnpin = options.onUnpin;
        this.onTop = options.onTop;
        this.onNotTop = options.onNotTop;
    }

    Headroom.prototype = {
        lastKnownScrollY: "",
        elem: "",
        debouncer: "",
        tolerance: "",
        classes: "",
        offset: "",
        scroller: "",
        initialised: "",
        onPin: "",
        onUnpin: "",
        onTop: "",
        onNotTop: "",
        constructor: Headroom,

        /**
         * Initialises the widget
         */
        init: function() {
            if (!Headroom.cutsTheMustard) {
                return;
            }

            this.elem.classList.add(this.classes.initial);

            // defer event registration to handle browser 
            // potentially restoring previous scroll position
            setTimeout(this.attachEvent.bind(this), 100);

            return this;
        },

        /**
         * Unattaches events and removes any classes that were added
         */
        destroy: function() {
            var classes = this.classes;

            this.initialised = false;
            this.elem.classList.remove(classes.unpinned, classes.pinned, classes.top, classes.initial);
            this.scroller.removeEventListener("scroll", this.debouncer, false);
        },

        /**
         * Attaches the scroll event
         * @private
         */
        attachEvent: function() {
            if (!this.initialised) {
                this.lastKnownScrollY = this.getScrollY();
                this.initialised = true;
                if (this.debouncer && this.debouncer.handleEvent) {
                    this.scroller.addEventListener("scroll", this.debouncer, false);
                    this.debouncer.handleEvent();
                }
            }
        },

        /**
         * Unpins the header if it's currently pinned
         */
        unpin: function() {
            var classList = this.elem.classList,
                classes = this.classes;

            if (classList.contains(classes.pinned) || !classList.contains(classes.unpinned)) {
                classList.add(classes.unpinned);
                classList.remove(classes.pinned);
                this.onUnpin && this.onUnpin.call(this);
            }
        },

        /**
         * Pins the header if it's currently unpinned
         */
        pin: function() {
            var classList = this.elem.classList,
                classes = this.classes;

            if (classList.contains(classes.unpinned)) {
                classList.remove(classes.unpinned);
                classList.add(classes.pinned);
                this.onPin && this.onPin.call(this);
            }
        },

        /**
         * Handles the top states
         */
        top: function() {
            var classList = this.elem.classList,
                classes = this.classes;

            if (!classList.contains(classes.top)) {
                classList.add(classes.top);
                classList.remove(classes.notTop);
                this.onTop && this.onTop.call(this);
            }
        },

        /**
         * Handles the not top state
         */
        notTop: function() {
            var classList = this.elem.classList,
                classes = this.classes;

            if (!classList.contains(classes.notTop)) {
                classList.add(classes.notTop);
                classList.remove(classes.top);
                this.onNotTop && this.onNotTop.call(this);
            }
        },

        /**
         * Gets the Y scroll position
         * @see https://developer.mozilla.org/en-US/docs/Web/API/Window.scrollY
         * @return {Number} pixels the page has scrolled along the Y-axis
         */
        getScrollY: function() {
            return (this.scroller.pageYOffset !== undefined)
                ? this.scroller.pageYOffset
                : (this.scroller.scrollTop !== undefined)
                ? this.scroller.scrollTop
                : (document.documentElement || document.body.parentNode || document.body).scrollTop;
        },

        /**
         * Gets the height of the viewport
         * @see http://andylangton.co.uk/blog/development/get-viewport-size-width-and-height-javascript
         * @return {int} the height of the viewport in pixels
         */
        getViewportHeight: function() {
            return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        },

        /**
         * Gets the height of the document
         * @see http://james.padolsey.com/javascript/get-document-height-cross-browser/
         * @return {int} the height of the document in pixels
         */
        getDocumentHeight: function() {
            var body = document.body,
                documentElement = document.documentElement;

            return Math.max(
                body.scrollHeight,
                documentElement.scrollHeight,
                body.offsetHeight,
                documentElement.offsetHeight,
                body.clientHeight,
                documentElement.clientHeight
            );
        },

        /**
         * Gets the height of the DOM element
         * @param  {Object}  elm the element to calculate the height of which
         * @return {int}     the height of the element in pixels
         */
        getElementHeight: function(elm) {
            return Math.max(
                elm.scrollHeight,
                elm.offsetHeight,
                elm.clientHeight
            );
        },

        /**
         * Gets the height of the scroller element
         * @return {int} the height of the scroller element in pixels
         */
        getScrollerHeight: function() {
            return (this.scroller === window || this.scroller === document.body)
                ? this.getDocumentHeight()
                : this.getElementHeight(this.scroller);
        },

        /**
         * determines if the scroll position is outside of document boundaries
         * @param  {int}  currentScrollY the current y scroll position
         * @return {bool} true if out of bounds, false otherwise
         */
        isOutOfBounds: function(currentScrollY) {
            var pastTop = currentScrollY < 0,
                pastBottom = currentScrollY + this.getViewportHeight() > this.getScrollerHeight();

            return pastTop || pastBottom;
        },

        /**
         * determines if the tolerance has been exceeded
         * @param  {int} currentScrollY the current scroll y position
         * @return {bool} true if tolerance exceeded, false otherwise
         */
        toleranceExceeded: function(currentScrollY, direction) {
            return Math.abs(currentScrollY - this.lastKnownScrollY) >= this.tolerance[direction];
        },

        /**
         * determine if it is appropriate to unpin
         * @param  {int} currentScrollY the current y scroll position
         * @param  {bool} toleranceExceeded has the tolerance been exceeded?
         * @return {bool} true if should unpin, false otherwise
         */
        shouldUnpin: function(currentScrollY, toleranceExceeded) {
            var scrollingDown = currentScrollY > this.lastKnownScrollY,
                pastOffset = currentScrollY >= this.offset;

            return scrollingDown && pastOffset && toleranceExceeded;
        },

        /**
         * determine if it is appropriate to pin
         * @param  {int} currentScrollY the current y scroll position
         * @param  {bool} toleranceExceeded has the tolerance been exceeded?
         * @return {bool} true if should pin, false otherwise
         */
        shouldPin: function(currentScrollY, toleranceExceeded) {
            var scrollingUp = currentScrollY < this.lastKnownScrollY,
                pastOffset = currentScrollY <= this.offset;

            return (scrollingUp && toleranceExceeded) || pastOffset;
        },

        /**
         * Handles updating the state of the widget
         */
        update: function() {
            var currentScrollY = this.getScrollY(),
                scrollDirection = currentScrollY > this.lastKnownScrollY ? "down" : "up",
                toleranceExceeded = this.toleranceExceeded(currentScrollY, scrollDirection);

            if (this.isOutOfBounds(currentScrollY)) { // Ignore bouncy scrolling in OSX
                return;
            }

            if (currentScrollY <= this.offset) {
                this.top();
            } else {
                this.notTop();
            }

            if (this.shouldUnpin(currentScrollY, toleranceExceeded)) {
                this.unpin();
            } else if (this.shouldPin(currentScrollY, toleranceExceeded)) {
                this.pin();
            }

            this.lastKnownScrollY = currentScrollY;
        }
    };
    /**
     * Default options
     * @type {Object}
     */
    Headroom.options = {
        tolerance: {
            up: 0,
            down: 0
        },
        offset: 0,
        scroller: window,
        classes: {
            pinned: "headroom-pinned",
            unpinned: "headroom-unpinned",
            top: "headroom-top",
            notTop: "headroom-not-top",
            initial: "headroom"
        }
    };
    Headroom.cutsTheMustard = typeof features !== "undefined" && features.rAF && features.bind && features.classList;

    window.Headroom = Headroom;

}(window, document));

(function($) {

    if (!$) {
        return;
    }

    ////////////
    // Plugin //
    ////////////

    $.fn.headroom = function(option) {
        return this.each(function() {
            var $this = $(this),
                data = $this.data("headroom"),
                options = typeof option === "object" && option;

            options = $.extend(true, {}, Headroom.options, options);

            if (!data) {
                data = new Headroom(this, options);
                data.init();
                $this.data("headroom", data);
            }
            if (typeof option === "string") {
                data[option]();
            }
        });
    };

    //////////////
    // Data API //
    //////////////

    $("[data-headroom]")
        .each(function() {
            var $this = $(this);
            $this.headroom($this.data());
        });

}(window.Zepto || window.jQuery));

/*jquery.event.drag.js ~ v1.5 ~ Copyright (c) 2008, Three Dub Media (http://threedubmedia.com)  
Liscensed under the MIT License ~ http://threedubmedia.googlecode.com/files/MIT-LICENSE.txt
*/
(function(E) {
    E.fn.drag = function(L, K, J) {
        if (K) {
            this.bind("dragstart", L);
        }
        if (J) {
            this.bind("dragend", J);
        }
        return !L ? this.trigger("drag") : this.bind("drag", K ? K : L);
    };
    var A = E.event,
        B = A.special,
        F = B.drag = {
            not: ":input",
            distance: 0,
            which: 1,
            dragging: false,
            setup: function(J) {
                J = E.extend({ distance: F.distance, which: F.which, not: F.not }, J || {});
                J.distance = I(J.distance);
                A.add(this, "mousedown", H, J);
                if (this.attachEvent) {
                    this.attachEvent("ondragstart", D);
                }
            },
            teardown: function() {
                A.remove(this, "mousedown", H);
                if (this === F.dragging) {
                    F.dragging = F.proxy = false;
                }
                G(this, true);
                if (this.detachEvent) {
                    this.detachEvent("ondragstart", D);
                }
            }
        };
    B.dragstart = B.dragend = { setup: function() {}, teardown: function() {} };

    function H(L) {
        var K = this, J, M = L.data || {};
        if (M.elem) {
            K = L.dragTarget = M.elem;
            L.dragProxy = F.proxy || K;
            L.cursorOffsetX = M.pageX - M.left;
            L.cursorOffsetY = M.pageY - M.top;
            L.offsetX = L.pageX - L.cursorOffsetX;
            L.offsetY = L.pageY - L.cursorOffsetY;
        } else {
            if (F.dragging || (M.which > 0 && L.which != M.which) || E(L.target).is(M.not)) {
                return;
            }
        }
        switch (L.type) {
        case"mousedown":
            E.extend(M, E(K).offset(), { elem: K, target: L.target, pageX: L.pageX, pageY: L.pageY });
            A.add(document, "mousemove mouseup", H, M);
            G(K, false);
            F.dragging = null;
            return false;
        case !F.dragging && "mousemove":
            if (I(L.pageX - M.pageX) + I(L.pageY - M.pageY) < M.distance) {
                break;
            }
            L.target = M.target;
            J = C(L, "dragstart", K);
            if (J !== false) {
                F.dragging = K;
                F.proxy = L.dragProxy = E(J || K)[0];
            }
        case"mousemove":
            if (F.dragging) {
                J = C(L, "drag", K);
                if (B.drop) {
                    B.drop.allowed = (J !== false);
                    B.drop.handler(L);
                }
                if (J !== false) {
                    break;
                }
                L.type = "mouseup";
            }
        case"mouseup":
            A.remove(document, "mousemove mouseup", H);
            if (F.dragging) {
                if (B.drop) {
                    B.drop.handler(L);
                }
                C(L, "dragend", K);
            }
            G(K, true);
            F.dragging = F.proxy = M.elem = false;
            break;
        }
        return true;
    }

    function C(M, K, L) {
        M.type = K;
        var J = E.event.handle.call(L, M);
        return J === false ? false : J || M.result;
    }

    function I(J) { return Math.pow(J, 2) }

    function D() { return(F.dragging === false) }

    function G(K, J) {
        if (!K) {
            return;
        }
        K.unselectable = J ? "off" : "on";
        K.onselectstart = function() { return J };
        if (K.style) {
            K.style.MozUserSelect = J ? "" : "none";
        }
    }
})(jQuery);

(function($, window, document, undefined) {
    var $window = $(window);

    $.fn.lazyload = function(options) {
        var elements = this;
        var $container;
        var settings = {
            threshold: 100,
            failure_limit: 10,
            event: "scroll",
            effect: "show",
            container: window,
            data_attribute: "src",
            skip_invisible: false,
            appear: null,
            load: null,
            placeholder:
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"
        };

        function update() {
            var counter = 0;

            elements.each(function() {
                var $this = $(this);
                if (settings.skip_invisible && !$this.is(":visible")) {
                    return;
                }
                if ($.abovethetop(this, settings) ||
                    $.leftofbegin(this, settings)) {
                    /* Nothing. */
                } else if (!$.belowthefold(this, settings) &&
                    !$.rightoffold(this, settings)) {
                    $this.trigger("appear");
                    /* if we found an image we'll load, reset the counter */
                    counter = 0;
                } else {
                    if (++counter > settings.failure_limit) {
                        return false;
                    }
                }
            });

        }

        if (options) {
            /* Maintain BC for a couple of versions. */
            if (undefined !== options.failurelimit) {
                options.failure_limit = options.failurelimit;
                delete options.failurelimit;
            }
            if (undefined !== options.effectspeed) {
                options.effect_speed = options.effectspeed;
                delete options.effectspeed;
            }

            $.extend(settings, options);
        }

        /* Cache container as jQuery as object. */
        $container = (settings.container === undefined ||
                settings.container === window)
            ? $window
            : $(settings.container);

        /* Fire one scroll event per scroll. Not one scroll event per image. */
        if (0 === settings.event.indexOf("scroll")) {
            $container.on(settings.event,
                function() {
                    return update();
                });
        }

        this.each(function() {
            var self = this;
            var $self = $(self);

            self.loaded = false;

            /* If no src attribute given use data:uri. */
            if ($self.attr("src") === undefined || $self.attr("src") === false) {
                if ($self.is("img")) {
                    $self.attr("src", settings.placeholder);
                }
            }

            /* When appear is triggered load original image. */
            $self.one("appear",
                function() {
                    if (!this.loaded) {
                        if (settings.appear) {
                            var elements_left = elements.length;
                            settings.appear.call(self, elements_left, settings);
                        }
                        $("<img />")
                            .one("load",
                                function() {
                                    var original = $self.attr("data-" + settings.data_attribute);
                                    $self.hide();
                                    if ($self.is("img")) {
                                        $self.attr("src", original);
                                    } else {
                                        $self.css("background-image", "url('" + original + "')");
                                    }
                                    $self[settings.effect](settings.effect_speed);

                                    self.loaded = true;

                                    /* Remove image from array so it is not looped next time. */
                                    var temp = $.grep(elements,
                                        function(element) {
                                            return !element.loaded;
                                        });
                                    elements = $(temp);

                                    if (settings.load) {
                                        var elements_left = elements.length;
                                        settings.load.call(self, elements_left, settings);
                                    }
                                })
                            .attr("src", $self.attr("data-" + settings.data_attribute));
                    }
                });

            /* When wanted event is triggered load original image */
            /* by triggering appear.                              */
            if (0 !== settings.event.indexOf("scroll")) {
                $self.on(settings.event,
                    function() {
                        if (!self.loaded) {
                            $self.trigger("appear");
                        }
                    });
            }
        });

        /* Check if something appears when window is resized. */
        $window.on("resize",
            function() {
                update();
            });

        /* With IOS5 force loading images when navigating with back button. */
        /* Non optimal workaround. */
        if ((/(?:iphone|ipod|ipad).*os 5/gi).test(navigator.appVersion)) {
            $window.on("pageshow",
                function(event) {
                    if (event.originalEvent && event.originalEvent.persisted) {
                        elements.each(function() {
                            $(this).trigger("appear");
                        });
                    }
                });
        }

        /* Force initial check if images should appear. */
        $(document)
            .ready(function() {
                update();
            });

        return this;
    };

    /* Convenience methods in jQuery namespace.           */
    /* Use as  $.belowthefold(element, {threshold : 100, container : window}) */

    $.belowthefold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = (window.innerHeight ? window.innerHeight : $window.height()) + $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top + $(settings.container).height();
        }

        return fold <= $(element).offset().top - settings.threshold;
    };

    $.rightoffold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.width() + $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left + $(settings.container).width();
        }

        return fold <= $(element).offset().left - settings.threshold;
    };

    $.abovethetop = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top;
        }

        return fold >= $(element).offset().top + settings.threshold + $(element).height();
    };

    $.leftofbegin = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left;
        }

        return fold >= $(element).offset().left + settings.threshold + $(element).width();
    };

    $.inviewport = function(element, settings) {
        return !$.rightoffold(element, settings) &&
            !$.leftofbegin(element, settings) &&
            !$.belowthefold(element, settings) &&
            !$.abovethetop(element, settings);
    };

    /* Custom selectors for your convenience.   */
    /* Use as $("img:below-the-fold").something() or */
    /* $("img").filter(":below-the-fold").something() which is faster */

    $.extend($.expr[":"],
    {
        "below-the-fold": function(a) { return $.belowthefold(a, { threshold: 0 }); },
        "above-the-top": function(a) { return !$.belowthefold(a, { threshold: 0 }); },
        "right-of-screen": function(a) { return $.rightoffold(a, { threshold: 0 }); },
        "left-of-screen": function(a) { return !$.rightoffold(a, { threshold: 0 }); },
        "in-viewport": function(a) { return $.inviewport(a, { threshold: 0 }); },
        /* Maintain BC for couple of versions. */
        "above-the-fold": function(a) { return !$.belowthefold(a, { threshold: 0 }); },
        "right-of-fold": function(a) { return $.rightoffold(a, { threshold: 0 }); },
        "left-of-fold": function(a) { return !$.rightoffold(a, { threshold: 0 }); }
    });

})(jQuery, window, document);

/*----*/
function loadNewsWaterFlow() {
    var bodyWidth = $(document.body).width();
    var con = $(".news-waterflow .news-list");
    if (con.length > 0 && bodyWidth > 800) {
        con.windswaterflow({
            itemSelector: ".news-list li",
            columnWidth: 264,
            marginWidth: 30,
            marginHeight: 50,
            boxParam: "num",
            pageParam: "page",
            maxPage: 0,
            init: false,
            initBoxNumber: 20,
            scroll: true,
            scrollBoxNumber: 10
        });
    }
}

/*----*/
function change2test() {
    var urlstart = "test";
    if (window.location.host.substr(0, 4).toLowerCase() === urlstart) {
        $("a")
            .each(function() {
                var o = $(this);
                var href = o.attr("href");
                // var urlReg = new RegExp("(http:\/\/|https:\/\/)?(([^\.]+\.)+(pedaily)([^\/]+\/?)+/)");
                if (href && href.length > 4 && href.indexOf("pedaily.cn") > -1 && href.indexOf("test.") < 1) {
                    o.attr("href", href.replace("http://", "http://test.").replace("test.test.", "test."));
                    //o.attr('href',href.replace("test.test.","test."));
                    //if (urlReg.test(href)) {
                    // o.attr("href", href.replace("test.","").replace(urlReg, "$1" + urlstart + ".$2"));
                    //}
                }
            });
    }
}
var smallimage = $("meta[name=ogimage]").attr("content");
var newsdata = {
    title: document.title,
    desc: $("meta[name=description]").attr("content"),
    link: location.href.split("#")[0],
    imgurl: smallimage == undefined ? "https://static.pedaily.cn/images/pedaily-weixin.jpg" : $("meta[name=ogimage]").attr("content"),
    sinaappid: 372732463,
    qqappid: 100248961
};
/*----*/
//焦点图统计
function addimgclicklog(o) {
    var homeImgReg = new RegExp("\\d{8}(\\d+)\\.shtml$", "ig");
    var url = $(o).parent().attr("href"),
        aid = $(o).attr("aid"),
        ix = $(o).parent().parent().index(),
        newsid = 0,
        d = homeImgReg.exec(url),
        jdata = { aid: aid, position: ix };
    if (d != null) {
        if (d.length === 2) {
            newsid = d[1];
        }
    }
    jdata.newsid = newsid;
    $.post(topPath + "/adlog.ashx?m=save", jdata, function(json) {});
}

/*----*/
/*
var jiathis_config = {
    data_track_clickback: "true",
    title: ($("h1").length > 0 ? "【" + $("h1").text() + "】" : ""),
    pic: $(".sharpic").attr("src"),
    summary: $("meta[name=description]").attr("content"),
    appkey: { "tsina": "372732463" },
    ralateuid: { "tsina": "pedaily" },
    evt: { "share": "addSharecount" }
};

window._bd_share_config = {
    common : {		
        bdText: newsdata.title,
        bdDesc: newsdata.desc,
        bdUrl : newsdata.link, 	
        bdPic: newsdata.imgurl,
        onBeforeClick: function (cmd, config) { addSharecount(cmd, config); }
    },
    share: [{
        "tag" : "share32",
        "bdSize": 32
    }, {
        "tag": "share24",
        "bdSize": 24
    }
    ],
    image: [{
        viewType: 'list',
        viewPos: 'top',
        viewColor: 'black',
        viewSize: '16',
        viewList: ['qzone', 'tsina', 'huaban', 'tqq', 'renren']
    }],
    selectShare: [{
        "bdselectMiniList": ['qzone', 'tqq', 'kaixin001', 'bdxc', 'tqf']
    }]
}
*/
/*----*/
var scollFocus = function($sobj) {
    var showPics = function(index, $sobj, index1) { //普通切换
		var speed=300;
		if(index1 != undefined && index1 != index){
			var n=index1-index;
			if(n < 0){
				n=-n;
			}
			speed= n * speed;
		}
        var oWidth = $sobj.width();
        var oHeight = $sobj.find("ul").height();
        var nowLeft = -index * oWidth; //根据index值计算ul元素的left值
        $sobj.find("ul").stop(true, false).animate({ "left": nowLeft }, speed); //通过animate()调整ul元素滚动到计算出的position
        //$("#focus .trans span").removeClass("on").eq(index).addClass("on"); //为当前的按钮切换到选中的效果
        $sobj.find(".trans span")
            .stop(true, false)
            .animate({ "opacity": "0.4" }, 300)
            .eq(index)
            .stop(true, false)
            .animate({ "opacity": "1" }, 300); //为当前的按钮切换到选中的效果
    };
    var counter = function($sobj) {
        var len = $sobj.data("counts");
        if (len == "" || len == null || typeof(len) == "null") {
            len = $sobj.find("li").length;
        }
        return len;
    };

    return{
        //显示图片函数，根据接收的index值显示相应的内容
        init: function($sobj) {
            if ($sobj.length == 0) return;
            var oWidth = $sobj.width();
            var oHeight = $sobj.find("ul li img").height();

            var len = counter($sobj);
            var dragstartX = 1;
            var dragX = 1;
			var dateStart=0;
            if (oWidth > 300 && oWidth < 800) {
                $sobj.height(oWidth / 2);
                $sobj.find("ul").height(oWidth / 2);
                $sobj.find("ul li").height(oWidth / 2);
                if ($sobj.data("height")) {
                    $sobj.height($sobj.data("height"));
                    $sobj.find("ul").height($sobj.data("height"));
                }
                if ($sobj.data("liheight")) {
                    $sobj.find("ul li").height($sobj.data("liheight"));
                }
            }
            if (len > 1) {
                if (!$sobj.data("counts")) {
                    $sobj.find("li").css("width", oWidth);
                }

                var index = 0, picTimer, i;
                var preHeight = (oHeight / 2 - 21);
                if ($sobj.children(".transBg").length == 0) $sobj.append('<div class="btnBg"></div>');
                if ($sobj.children(".pre").length == 0) $sobj.append('<div class="preNext pre"></div>');
                if ($sobj.children(".next").length == 0) $sobj.append('<div class="preNext next"></div>');
                if ($sobj.children(".trans").length == 0) {
                    var trans = '<div class="trans" style="margin-left:-' + ((len * 15) / 2) + 'px">';
                    for (i = 0; i < len; i++) {
                        trans += "<span></span>";
                    }
                    trans += "</div>";
                    $sobj.append(trans);
                }
                $sobj.find(".transBg").css("opacity", 0.5);
                //为小按钮添加鼠标滑入事件，以显示相应的内容
                var transs = $sobj.find(".trans span");
                transs.css("opacity", 0.4)
                    .mouseenter(function() {
						var i=index;
                        index = transs.index(this);
                        showPics(index, $sobj,i);
                    })
                    .eq(0)
                    .trigger("mouseenter");
                //上一页、下一页按钮透明度处理
                $sobj.find(".preNext")
                    .css("opacity", 0.2)
                    .css("top", preHeight)
                    .hover(function() {
                            $(this).stop(true, false).animate({ "opacity": "0.5" }, 300);
                        },
                        function() {
                            $(this).stop(true, false).animate({ "opacity": "0.2" }, 300);
                        });
                //上一页按钮
                $sobj.find(".pre")
                    .click(function() {
						var i=index;
                        index -= 1;
                        if (index == -1) {
                            index = len - 1;
                        }
                        showPics(index, $sobj,i);
                    });
                //下一页按钮
                $sobj.find(".next")
                    .click(function() {
						var i=index;
                        index += 1;
                        if (index == len) {
                            index = 0;
                        }
                        showPics(index, $sobj,i);
                    });


                $sobj.bind("touchstart",
                    function(e) {
                        dragstartX = e.pageX || e.originalEvent.touches[0].pageX;
                        dragstartX = e.originalEvent.targetTouches[0].pageX;
                        //alert('touchstart:'+dragstartX);
						dateStart=new Date();
                    });

                $sobj.bind("touchmove",
                    function(e) {
                        dragX = (e.pageX || e.originalEvent.touches[0].pageX) - dragstartX;
                        //dragX = e.originalEvent.targetTouches[0].clientX;
                        var nowLeft = -index * oWidth + dragX;
                        //console.log(dragX);
                        //alert('touchmove:'+dragX);
                        $sobj.find("ul").animate({ "left": nowLeft }, 0); //通过animate()调整ul元素滚动到计算出的position

                    });
                $sobj.bind("touchend",
                    function(e) {
                        var dragXX = dragX > 0 ? dragX : (-dragX);
						var timeSpan=new Date().getTime()-dateStart.getTime();
						//console.log(timeSpan);
						//alert('touchend:'+dragXX);
						var n=timeSpan<300? Math.ceil(dragXX/oWidth):Math.round(dragXX/oWidth);
						var i=index;
						if (dragX < 0) {
							index += n;
							if (index >= len) {
								index = 0;
							}
							//console.log('方法1:'+'dragX:'+dragX + 'n:'+n+'index:'+ index);
							showPics(index, $sobj, i);
						} else {
							index -= n;
							if (index < 0) {
								index = len -1;
							}
							//console.log('方法2:'+'dragX:'+dragX + 'n:'+n+'index:' +index);
							showPics(index, $sobj, i);
						}
                    });
                //本例为左右滚动，即所有li元素都是在同一排向左浮动，所以这里需要计算出外围ul元素的宽度
                $sobj.find("ul").css("width", $sobj.width() * (len));
                //鼠标滑上焦点图时停止自动播放，滑出时开始自动播放
                $sobj.hover(function() {
                            clearInterval(picTimer);
                        },
                        function() {
                            picTimer = setInterval(function() {
                                    showPics(index, $sobj);
                                    index++;
                                    if (index == len) {
                                        index = 0;
                                    }
                                },
                                $sobj.attr("interval") || 4 * 1000); //此4000代表自动播放的间隔，单位：毫秒
                        })
                    .trigger("mouseleave");

            }
        }
    };
}();
/*----*/

function setScollHeight() {
	var adHeight = 0;
	if($("#bigAdImg").is(":hidden")){
		adHeight = 0;
	}else{
		adHeight = $("#bigAd").height();
	};
	var scollHeight = 250 + adHeight;
    if ($(window).scrollTop() >= scollHeight) //距离顶部多少高度显示按钮
    {
        if (bodyWidth > 801) {
            if ($(".slideUp").length > 0) {
                $("#nav-fix").css("top", 5).addClass("nav-fix");
            } else {
                $("#nav-fix").css("top", 60).addClass("nav-fix");
            }
            $("#top-home-text").hide();
            $("#top-home-logo").show();
        }
        $("#backTop").slideDown(200);

    } else {
        $("#backTop").slideUp(200);
        $("#nav-fix").css("top", "").removeClass("nav-fix");
        if (bodyWidth > 639) {
            $("#top-home-text").show();
            $("#top-home-logo").hide();
        }
    }
}

/*----*/
var scollHeightnews =450;/* $("#news-nav-fix").offset().top;*/

function setScollHeightnews() {
    if ($(window).scrollTop() >= scollHeightnews) //距离顶部多少高度显示按钮
    {
        if (bodyWidth > 800) {
            if ($("#page-top").hasClass("slideUp")) {
                $("#news-nav-fix").css("top", 5).addClass("news-nav-fix");
            } else {
                $("#news-nav-fix").css("top", 60).addClass("news-nav-fix");
            }
        }
    } else {
        $("#news-nav-fix").css("top", "").removeClass("news-nav-fix");
    }
};

/*----*/
var totalPage = 1, totalcount = 0;
var bodyWidth = $(document.body).width();
var currentUrl = window.location.href;

/*----*/
var _Mobile = {
    init: function() {
        _Mobile.mobile_share_btn_click();
        _Mobile.mobile_setnav_current();
        _Mobile.mobile_setmenu();
        _Mobile.mobile_menu_btn_click();
        _Mobile.mobile_loadsearchmap();

    },
    mobile_setmenu: function() {
        if (bodyWidth <= 1000) {
            $("#mobile-bar-copy").html($("#mobile-bar").html());
            $("#mobile-menus-copy").html($("#mobile-menu-list").html());
            var mobile_copy = $("#mobile-nav-num").html();
            if (mobile_copy != null) {
                $("#mobile-nav-num").html("");
                $("#mobile-nav-main-copy").html(mobile_copy);
                $("#nav-main-copy").addClass($("#mobile-nav-num").attr("class"));
            } else {
                $("#nav-main-copy").remove();
            }
            $("#mobile-nav-main-default").remove();
            var w = 0;
            var n = 0;
            var aw = 0;
            var lw = 0;
            $("#mobile-nav-main-copy a")
                .each(function() {
                    if (!$(this).hasClass("mobile-hide")) {
                        w += $(this).outerWidth();
                        n++;
                        lw = $(this).width();
                        /*console.log(w+'-----'+$(this).outerWidth()+'-----'+$(this).width()+'-----'+$(this).text());*/
                    }

                });
            if (n <= 4) {
                $("#mobile-nav-main-copy").addClass("mobile-nav-list mobile-nav-list-" + n);
            } else {
                $("#mobile-nav-main-copy").width(w + 2);
            }
            if (bodyWidth >= 600) {
                $("#mobile-nav-main-copy").addClass("mobile-nav-list mobile-nav-list-" + n);
            }
            $("#mobile-nav-main-copy a")
                .each(function() {
                    if (!$(this).hasClass("mobile-hide")) {
                        aw += $(this).outerWidth();
                        w = $(this).outerWidth();

                        if ($(this).hasClass("current")) {
                            return false;
                        }
                    }
                });
            var sw = aw - bodyWidth / 2 - w / 2;
            if ((aw - w) > (((bodyWidth) / 2) + 5)) {
                $("#nav-main-copy").scrollLeft(sw);
            }
            /*console.log(sw+'--'+(aw)+'---'+bodyWidth/2);*/

            if ($("body").hasClass("user-page")) {
                $("#mobile-menus").html($("#mobile-user-nav").html());
            }
        }
    },
    mobile_setnav_current: function() {
        $("#mobile-nav-num")
            .find("a")
            .each(function(i) {
                /*http://research.pedaily.cn/*/
                var href = $(this).attr("href").replace("test.", "") + "/////";
                var curl = currentUrl.replace("test.", "") + "/////";
                var a = href.split("/");
                var b = curl.split("/");
                if (a[2] == b[2] && (a[3] + a[4] == b[3] + b[4] || a[3] + a[4] == b[3])) {
                    $(this).addClass("current");
                }
            });
    },
    mobile_menu_btn_click: function() {
        $(".mobile-menu-home")
            .click(function() {
                if ($("body").hasClass("mobile-menu-dowm")) {
                    $("body").removeClass("mobile-menu-dowm");
                } else {
                    $("body").addClass("mobile-menu-dowm");
                }
            });
        $("#mobile-cover")
            .click(function(e) {
                var _target = $(e.target);
                if (_target.closest("#mobile-menu").length == 0) {
                    $("body").removeClass("mobile-menu-dowm");
                }
            });
        $(".mobile-menu-search, #mobile-search-close")
            .click(function() {
                var body_ = $("#mobile-search-page");
                if (body_.hasClass("mobile-search-page")) {
                    body_.removeClass("mobile-search-page");
                    $("body").removeClass("mobile-menu-open-search");
                } else {
                    body_.addClass("mobile-search-page");
                    $("body").addClass("mobile-menu-open-search");
                }
            });
    },
    mobile_share_btn_click: function() {
        $("#mobile-share-btn")
            .text("分享")
            .click(function(e) {
                var share_ = $("#mobile-share-box");
                if (share_.hasClass("mobile-share-down")) {
                    share_.removeClass("mobile-share-down");
                } else {
                    share_.addClass("mobile-share-down").removeClass("mobile-share-up");
                }
            });

        $("#mobile-share-cancel")
            .text("取消")
            .click(function(e) {
                var share_ = $("#mobile-share-box");
                share_.removeClass("mobile-share-down").addClass("mobile-share-up");
            });

        $("#mobile-share-cover")
            .click(function(e) {
                var _target = $(e.target);
                if (_target.closest("#mobile-share-content").length == 0) {
                    var body_ = $("#mobile-share-box");
                    body_.removeClass("mobile-share-down").addClass("mobile-share-up");
                }
            });
    },
    mobile_get_lastnews: function() {
        if (bodyWidth <= 1000) {
            var obj = $("#news-show-lastnews #box-loadmore #loadmore");
            if (obj.length > 0) {
                obj.click();
            }
        }

    },
    mobile_loadsearchmap: function() {
        var searchmap =
            '<div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://pe.pedaily.cn/" target="_blank">投资</a></span></h3></div><div class="map-list">	<a href="http://pe.pedaily.cn/vcpe/" target="_blank">VC/PE</a><a href="http://pe.pedaily.cn/angel-investment/" target="_blank">天使</a><a href="http://pe.pedaily.cn/new-third-board/" target="_blank">新三板</a><a href="http://pe.pedaily.cn/capitalevent/" target="_blank">资本事件</a><a href="http://pe.pedaily.cn/ranking/" target="_blank">排名榜单</a></div></div><div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://news.pedaily.cn/" target="_blank">行业</a></span></h3></div><div class="map-list"><a href="http://news.pedaily.cn/vcpenews/" target="_blank">产业动态</a><a href="http://news.pedaily.cn/companyfocus/" target="_blank">巨头</a><a href="http://news.pedaily.cn/unicorn/" target="_blank">生死独角兽</a><a href="http://news.pedaily.cn/analysis/" target="_blank">分析评论</a></div></div><div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://people.pedaily.cn/" target="_blank">人物</a></span></h3></div><div class="map-list">	<a href="http://people.pedaily.cn/interview/" target="_blank">顶级投资人</a><a href="http://people.pedaily.cn/investor100/" target="_blank">投资界100</a><a href="http://people.pedaily.cn/life/" target="_blank">悦生活</a><a href="http://people.pedaily.cn/u/" target="_blank">投资界专栏</a><a href="http://people.pedaily.cn/u/experts/" target="_blank">专栏人物</a></div></div><div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://research.pedaily.cn/" target="_blank">研究</a></span></h3></div><div class="map-list">	<a href="http://research.pedaily.cn/observation/" target="_blank">清科观察</a><a href="http://research.pedaily.cn/vcpedata/" target="_blank">清科数据</a><a href="http://research.pedaily.cn/report/" target="_blank">清科报告</a><a href="http://people.pedaily.cn/u/analyst/" target="_blank">分析师专栏</a><a href="http://research.pedaily.cn/report/pay/ranking/" target="_blank">清科榜单</a></div></div><div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://news.pedaily.cn/events/" target="_blank">会议</a></span></h3></div><div class="map-list">	<a href="http://news.pedaily.cn/events/events-e1/" target="_blank">股权投资论坛</a><a href="http://news.pedaily.cn/events/events-e9/" target="_blank">Venture50</a><a href="http://news.pedaily.cn/events/events-e3/" target="_blank">地方论坛</a><a href="http://news.pedaily.cn/events/events-e4/" target="_blank">沙龙</a><a href="http://news.pedaily.cn/events/events-e7/" target="_blank">培训</a><a href="http://news.pedaily.cn/events/events-e8/" target="_blank">新芽Demo</a> </div></div><div class="box-map"><div class="box-plate"><h3><span class="line blue"><a href="http://zdb.pedaily.cn/" target="_blank">数据</a></span></h3></div><div class="map-list">	<a href="http://zdb.pedaily.cn/inv/" target="_blank">投资事件</a><a href="http://zdb.pedaily.cn/pe/" target="_blank">募资事件</a><a href="http://zdb.pedaily.cn/ipo/" target="_blank">上市事件</a><a href="http://zdb.pedaily.cn/ma/" target="_blank">并购事件</a><a href="http://zdb.pedaily.cn/company/all/" target="_blank">机构</a><a href="http://zdb.pedaily.cn/people/" target="_blank">投资人</a><a href="http://zdb.pedaily.cn/enterprise/" target="_blank">企业库</a></div></div>';
        $("#search-map").html(searchmap);

    }

};

var _Web = {
    init: function() {
        //按钮定位
        var winWidth = $(window).width(); //窗口宽度
        var contentWidth = $(".main").width(); //容器宽度
        var topbtnWidth = 60; //按钮宽度
        var topbtnPosi = ([winWidth - contentWidth] / 2 - topbtnWidth - 10);
        if (topbtnPosi < 0) {
            topbtnPosi = 0;
        }
        //距离主体部分的右侧距离
        if (bodyWidth >= 100) {
            $("#page-top")
                .headroom({
                    tolerance: 5,
                    offset: 44,
                    classes: { initial: "top", pinned: "slideDown", unpinned: "slideUp" }
                });
        }
        $("#box-scoll").html('<a href="mailto:editor@zero2ipo.com.cn" class="submission" id=""><i class="icon icon-submission"></i><span>投稿</span></a><a href="javascript:suggest();" id=""><i class="icon icon-feedback"></i><span>提建议</span></a><a href="javascript:void(0)" id="backTop"><i class="icon icon-backtop" ></i><span>回顶部</span></a>');
        $("#backTop").click(function() { $("body, html").animate({ scrollTop: 0 }, 300) }).css({ 'right': topbtnPosi });
        $(".events-list dl")
            .hover(function(index) {
                $(".events-list dl").addClass("list-title");
                $(this).removeClass("list-title");
            });
        /*$(".news-list .img a").find("img").each(function(i) {var url = $(this).attr("href"); });*/
        $("#top-dropdown-menu")
            .html('<li><a target="_blank" href="http://www.zero2ipo.com.cn/">清科集团</a></li><li><a target="_blank" href="http://fof.zero2ipo.com.cn/">清科母基金</a></li><li><a target="_blank" href="http://www.pemanager.cn/">创投管家</a></li><li><a target="_blank" href="http://www.pestreet.cn/">财富街</a></li><li><a target="_blank" href="http://www.pedata.cn/">私募通</a></li><li><a target="_blank" href="http://pemarket.com.cn/">项目工场</a></li><li><a target="_blank" href="http://sandhill.zero2ipo.com.cn/">沙丘学院</a></li>');
        if ($(".add-favor").length > 0) {
            _Favor.init();
        }
        _Web.loaddropdown();
        _Web.setColumnRandomBg();
		_Web.setNewsViewSimple();


    },
    setColumnRandomBg: function() {
        var n = parseInt(11 * Math.random()) + 1;
        var banner = $("#ubannerbg");
        if (banner) {
            banner.css("background-image", "url(https://static.pedaily.cn/head/images/blog/" + n + ".jpg)")
                .css("background-position", "top center");
        }
    },
    loaddropdown: function() {
        $(".dropdowm")
            .hover(function() { $(this).find(".dropdown-menu").slideDown(); },
                function() { $(this).find(".dropdown-menu").slideUp(); });
    },
	setNewsViewSimple:function()
	{
		if($('body').hasClass('news-view'))
		{
			var isNewsViewSimple=0;
			isNewsViewSimple=Cookies.Get("setnewsviewsimple")
			if (isNewsViewSimple==''){isNewsViewSimple=0}
			if (isNewsViewSimple==1)
			{
				$('body').addClass('news-view-simple');
				$("#box-scoll").prepend('<a href="javascript:void(0)" id="setnewsviewsimple" title="简版方式阅读"><i class="icon icon-order"></i><span id="setnewsviewsimpletext">原版</span></a>');
			}
			else
			{
				$("#box-scoll").prepend('<a href="javascript:void(0)" id="setnewsviewsimple" title="原版方式阅读"><i class="icon icon-order"></i><span id="setnewsviewsimpletext">简版</span></a>');
			}
			$('#setnewsviewsimple').click(function(){
				if($('body').hasClass('news-view-simple'))
				{
					$('body').removeClass('news-view-simple');
					$('#setnewsviewsimpletext').text('简版');
					$('#setnewsviewsimple').attr('title','简版方式阅读');
					Cookies.Set("setnewsviewsimple", 0,360, "/", ".pedaily.cn");
				}
				else
				{
					$('body').addClass('news-view-simple');
					$('#setnewsviewsimpletext').text('原版');
					$('#setnewsviewsimple').attr('title','原版方式阅读');
					Cookies.Set("setnewsviewsimple", 1,360, "/", ".pedaily.cn");
				}
			});
		}
	
	}
};

var _share = {
    qzonesurl: {},
    sinasurl: {},
    init: function () {
        this.start();
        $('.share .icon-weibo-c').click(function () { _share.sina(); });
        $('.share .icon-wechat-c').click(function () { _share.wx(); });
        $('.share .icon-qzone-c').click(function () { _share.qzone(); });
    },
    start:function() {
        _Common.loadScript("https://tjs.sjs.sinajs.cn/open/api/js/wb.js");
        _Common.loadScript("https://qzonestyle.gtimg.cn/qzone/app/qzlike/qzopensl.js#jsdate=" + new Date().getHours());
        var p = {
            url: newsdata.link,
            showcount: '1',/*是否显示分享总数,显示：'1'，不显示：'0' */
            desc: newsdata.desc,/*默认分享理由(可选)*/
            summary: newsdata.desc,/*分享摘要(可选)*/
            title: newsdata.title,/*分享标题(可选)*/
            site: '投资界',/*分享来源 如：腾讯网(可选)*/
            pics: newsdata.imgurl, /*分享图片的路径(可选)*/
            style: '203',
            width: 98,
            height: 22
        };
        var s = [];
        for (var i in p) {
            s.push(i + '=' + encodeURIComponent(p[i] || ''));
        }
        this.qzonesurl = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?" + s.join('&');
        var sina= {
            url: newsdata.link,
            appkey: newsdata.sinaappid,
            title: ($("h1").length > 0 ? "【" + $("h1").text() + "】" : "")+newsdata.desc,
            pic: newsdata.imgurl,
            language: 'zh_cn'
        }
        var s1 = [];
        for (var i in sina) {
            s1.push(i + '=' + encodeURIComponent(sina[i] || ''));
        }
        this.sinasurl = "https://service.weibo.com/share/share.php?" + s1.join('&');
    },
    sina:function() {
        _share.addSharecount();
        window.open(_share.sinasurl);
    },
    qzone:function() {
        _share.addSharecount();
        window.open(_share.qzonesurl)
    },
    wx:function() {
        _share.addSharecount();
        openQrCode();
    },
    addSharecount:function () {
        var url = newsdata.link;
        var rid = 0;
        var re = /\d{8}(\d+)\.shtml/;
        if (re.test(url)) {
            rid = RegExp.$1;
        } else {
            var match = url.match(/(\d+)\.shtml/);
            if (match!=null && match.length > 0) {
                rid = match[1];
            }
        }
        if (rid > 0) {
            $.getJSON(topPath + "/handler.ashx?action=addSharecount&rid=" + rid, "");    
        }
    }
}

var _Favor = {
    onerr: function() { /*win.warn("出现错误，请稍后重试！");*/ },
    bindFavor: function(id, title) {
        $(".add-favor")
            .click(function() {
                if (!users.logined) {
                    users.globalLogin();
                    return;
                }
                var onerr = function() { /*win.warn("出现错误，请稍后重试！");*/ };
                var obj = $(this);
                $.ajax({
                    url: topPath + "/handler.ashx?action=addFavor",
                    data: { id: id, title: title, url: location.href },
                    type: "Post",
                    dataType: "json",
                    error: onerr,
                    success: function(json) {
                        if (json.code === 1) {
                            obj.addClass("has-favor");
                            $("#favor-state").html("已收藏");
                            obj.unbind("click");
                        } else {
                            win.warn(json.msg);
                        }
                    }
                });
            });
    },
    init: function() {
        var content = $("#final-content");
        var id = content.attr("data-id");
        var title = content.attr("data-title");
        var btnfavor = $("#add_favor");
        $.ajax({
            url: topPath + "/handler.ashx?action=getFavor&resid=" + id,
            type: "Get",
            dataType: "json",
            error: _Favor.onerr,
            success: function(json) {
                if (json) {
                    if (json.code === 1) {
                        if (json.hasfavor == undefined || json.hasfavor < 1) {
                            btnfavor.html('<i class="icon icon-favorite"></i> <span id="favor-state">收藏</span>');
                            _Favor.bindFavor(id, title);
                        } else {
                            btnfavor.html('<i class="icon icon-favorite"></i> <span id="favor-state">已收藏</span>');
                            btnfavor.removeClass("add-favor").addClass("has-favor");
                        }
                    }
                }
            }
        });
    }
};


users.init();
 _Web.init();
jQuery(document)
    .ready(function() {
        _wx.init();
        if ($('.share .icon-weibo-c').length>0) {
            _share.init();    
        }
        if (bodyWidth < 801) {
            $(".news-waterflow").removeClass("news-waterflow");
        } else {
            loadNewsWaterFlow();
            var listads = $(".adver_show");
            var obj =
                '<span style="vertical-align:middle; text-align:center;  padding-left:20px; background:url(https://static.pedaily.cn/images/ajaxloader.gif)left center no-repeat;">广告加载中...</span>';;
            listads.each(function() {
                if ($(this).html().indexOf("BAIDU_CLB_fillSlot") > -1) {
                    $(this).html(obj);
                }
            });
          
            if (bodyWidth >= 1000) {
				setNewsListSpecial();
				jQuery.getScript("https://cbjs.baidu.com/js/m.js")
                .done(function() {
                    /*--广告图片投放--*/
                    var listads = $(".adver_show");
                    listads.each(function() {
                        var objid = $(this).attr("id");
                        if (objid) {
                            var adverid = objid.split("_")[2];
                            if (isExitsFunction("BAIDU_CLB_fillSlotAsync")) {
                                $(this).html("");
                                BAIDU_CLB_fillSlotAsync(adverid, objid);
                            } else {
                                var func = "BAIDU_CLB_fillSlotAsync(" + adverid + "," + objid + ")";
                                setTimeout(func, 2000);
                            }
                        }
                    });
                })
                .fail(function() {});

                $(".ad-show")
                    .each(function() {
                        var objid = $(this).attr("id");
                        if (objid) {
                            var adverid = objid.split("_")[2];
                            if (isExitsFunction("BAIDU_CLB_fillSlotAsync")) {
                                BAIDU_CLB_fillSlotAsync(adverid, objid);
                            } else {
                                var func = "BAIDU_CLB_fillSlotAsync(" + adverid + "," + objid + ")";
                                setTimeout(func, 2000);
                            }
                        }
                    });
            }
        }
       
        _LoadMore.init();
        _Mobile.init();
        setScollHeight();
        setScollHeightnews();
        imgAnimate();
        changeTarget();
        
        /*--轮播--*/
        scollFocus.init($("#index-focus"));
        scollFocus.init($("#case-scoll-focus"));
        scollFocus.init($("#news-relate-focus"));
        scollFocus.init($("#focuscompany-scoll-focus"));
        scollFocus.init($("#column-focus"));
        scollFocus.init($("#analyst-focus"));
		scollFocus.init($("#hello-focus"));
		scollFocus.init($("#book-focus"));
        /*--轮播--*/
        setScroll();
        /*--时间转换--*/
        dateConvert();
        /*change2test();*/
        /*--评论框--*/
        //sinaComment();
        /*--评论框--*/

        /*--手机端下载提示条--*/
        if (bodyWidth < 800) {
			var url = window.location.href;
			var urlhref = url.indexOf("?applink");
			if (urlhref < 0) {
				if (!Cookies.Get("hide_download")) {
					$(".app-download-bottom").show();
				};
			};

            $(".app-download-bottom, .app-download-close")
                .click(function() {
                    $(".app-download-bottom").hide();
                    Cookies.Set("hide_download", 1, 1, "/", ".pedaily.cn");
                });
        }
        /*--手机端下载提示条end--*/


    });
/*--自媒体背景图自动切换--*/
function sinaComment() {
//    var flag = true;
//    var finalcontent = $("#final-content");
//    if (finalcontent.length > 0) {
//        flag = finalcontent.data("iscomment");
//        if (flag == "False") {
//            flag = false;
//        }
//    }
//    if (flag) {
//        var _cmt = $("#content-comment");
//        if (_cmt) {
//            var isshow = true;
//            isshow = $("#final-content").data("iscomment");
//            if (!isshow) {
//                _cmt.html('<h2 class="caption">网友评论</h2><div style="text-align:center;padding:30px;">评论已关闭</div>');
//            } else {
//                setTimeout(function () {
//                    var url = document.location.href;
//                    var content = '<h2 class="caption">网友评论</h2><div><wb:comments url="' + url + '" brandline="n" fontsize="12" width="auto" appkey="372732463" color="e6eaed,ffffff,787878,1482be,e6eaed,f5f5f5"></wb:comments></div>';
//                    _cmt.html(content);

//                    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
//                    ga.src = 'http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=372732463';
//                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
//                }, 1000);
//            }
//        };
//    }
}

/*----*/
function setScroll() {
    $(window)
        .scroll(function() {
            setScollHeight();
            setScollHeightnews();
            var documentHeight = $(document).height() - $(window).height(); //文本高度-屏幕高度
            var scrolltop = $(window).scrollTop();
            var fixcontent = $("#box-fix-content");
            var friendlink = $(".friendlink"), friendlinkHeight;
            if (friendlink != undefined && friendlink != "") {
                friendlinkHeight = friendlink.height();
            } else {
                friendlinkHeight = 0;
            }
            if ($("#page-top").height() <= 1) {

                $("body").addClass("mobile-main-menu");
            } else {
                $("body").removeClass("mobile-main-menu");
            }
      	    if (bodyWidth >= 1000&&$(".news-view .page-content ").length>0 ){
				var boxFixRHeiht = $(".news-view .page-content ").find(".box-fix-r").height() + 180;
				if (fixcontent != undefined)
					if (fixcontent.html() != null && $("#box-fix-content").parent().attr("id") != "main") {
						if (scrolltop > boxFixRHeiht) {
							fixcontent.addClass("box-fix-content");
						} else {
							fixcontent.removeClass("box-fix-content");
						}
						if (fixcontent.offset().top >
						($("#footer").offset().top - $("#footer").height() - friendlinkHeight)) {
							fixcontent.removeClass("box-fix-content");
						}
					}
			 }
            if (bodyWidth <= 800 & scrolltop > documentHeight - 40 &&
                _LoadMore.totalPage > 1 &&
                _LoadMore.p <= _LoadMore.totalPage) {
                _LoadMore.getMoreData();
            }
            if (bodyWidth <= 800 & scrolltop > documentHeight - 300) {
                _Mobile.mobile_get_lastnews();
            }


        });
}

/*----*/

function setShare(title, url, summary, pic) {
    jiathis_config.title = title;
    jiathis_config.url = url;
    jiathis_config.summary = summary;
    jiathis_config.pic = pic;
}

/*----*/
function addSharecount(cmd,config) {
    var url = config.bdUrl;
    var rid = 0;
    var re = /\d{8}(\d+)\.shtml/;
    if (re.test(url)) {
        rid = RegExp.$1;
    } else {
        var match = url.match(/(\d+)\.shtml/);
        if (match.length > 0) {
            rid = match[1];
        }
    }
    if (rid > 0) {
        $.getJSON(topPath + "/handler.ashx?action=addSharecount&rid=" + rid, "");    
    }
}

/*--日期转换start--*/
function dataConvert(varparam) {
    var minute = 1000 * 60;
    var hour = minute * 60;
    var day = hour * 24;
    var halfamonth = day * 15;
    var month = day * 30;
    var dateTimeStamp = DataParse(varparam);
    var now = new Date().getTime();
    var diffValue = now - dateTimeStamp;
    var monthC = diffValue / month;
    var weekC = diffValue / (7 * day);
    var dayC = diffValue / day;
    var hourC = diffValue / hour;
    var minC = parseInt(diffValue / minute);
    if (dayC >= 1) {
        if (bodyWidth > 800) {
            return new Date(DataParse(varparam)).format("yyyy年MM月dd日 hh时");
        } else {
            return new Date(DataParse(varparam)).format("MM月dd日 hh时");
        }
        //return formatDate(new Date(varparam),'yyyy年MM月dd日 hh时');
    }
    var result;
    if (dayC < 1 && hourC >= 1) {
        result = parseInt(hourC) + "小时前";
    } else if (hourC < 1 && minC >= 1) {
        result = parseInt(minC) + "分钟前";
    } else {
        result = "刚刚发表";
    }
    return result;
}

/*----*/
function DataParse(data) {
    return Date.parse(data.replace("-", "/").replace("-", "/"));
}

/*----*/
Date.prototype.format = function(format) //author: alex 
{
    var o = {
        "M+": this.getMonth() + 1, //month 
        "d+": this.getDate(), //day 
        "h+": this.getHours(), //hour 
        "m+": this.getMinutes(), //minute 
        "s+": this.getSeconds(), //second 
        "q+": Math.floor((this.getMonth() + 3) / 3), //quarter 
        "S": this.getMilliseconds() //millisecond 
    };
    if (/(y+)/.test(format))
        format = format.replace(RegExp.$1,
        (this.getFullYear() + "").substr(4 - RegExp.$1.length));
    for (var k in o)
        if (new RegExp("(" + k + ")").test(format))
            format = format.replace(RegExp.$1,
                RegExp.$1.length == 1 ? o[k] : ("00" + o[k]).substr(("" + o[k]).length));
    return format;
};

/*----*/
//格式化日期,
function formatDate(date, format) {
    var paddNum = function(num) {
        num += "";
        return num.replace(/^(\d)$/, "0$1");
    };
//指定格式字符
    var cfg = {
        yyyy: date.getFullYear() //年 : 4位
        ,
        yy: date.getFullYear().toString().substring(2) //年 : 2位
        ,
        M: date.getMonth() + 1 //月 : 如果1位的时候不补0
        ,
        MM: paddNum(date.getMonth() + 1) //月 : 如果1位的时候补0
        ,
        d: date.getDate() //日 : 如果1位的时候不补0
        ,
        dd: paddNum(date.getDate()) //日 : 如果1位的时候补0
        ,
        hh: date.getHours() //时
        ,
        mm: date.getMinutes() //分
        ,
        ss: date.getSeconds() //秒
    };
    format || (format = "yyyy-MM-dd hh:mm:ss");
    return format.replace(/([a-z])(\1)*/ig, function(m) { return cfg[m]; });
}

/*--日期转换end--*/
//是否存在指定函数 
function isExitsFunction(funcName) {
    try {
        if (typeof(eval(funcName)) == "function") {
            return true;
        }
    } catch (e) {
    }
    return false;
}

var _wx = {
    init:function() {
        if (_Common.isWeixin()) {
			_wx.config();
			//_Common.addScript("https://res.wx.qq.com/open/js/jweixin-1.0.0.js",_wx.config);
        }
		//_wx.config();
    },
    config: function () {
        var url = location.href.split("#")[0];
        $.ajax({
            url: "/top/handlers/weixin.ashx?action=config",
            type: "post",
            data: { url: encodeURIComponent(url) },
            success: function (data) {
				//console.log(data);
                if (data.code === 1) {
                    wx.config({
                        debug: false,
                        appId: data.data.appid,
                        timestamp: data.data.timestamp,
                        nonceStr: data.data.nonceStr,
                        signature: data.data.signature,
                        jsApiList: ["onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareWeibo", "onMenuShareQZone"]
                    });
                }
            }
        });
        _wx.ready();
    },
    ready:function() {
        wx.ready(function () {
            wx.onMenuShareAppMessage({
                title: newsdata.title,
                desc: newsdata.desc,
                link: newsdata.link,
                imgUrl: newsdata.imgurl,
                type: "link",
                dataUrl: "",
                success: function () { },
                cancel: function () { }
            });
            wx.onMenuShareTimeline({
                title: newsdata.title,
                link: newsdata.link,
                imgUrl: newsdata.imgurl,
                success: function () { },
                cancel: function () { }
            });
            wx.onMenuShareQQ({
                title: newsdata.title,
                desc: newsdata.desc,
                link: newsdata.link,
                imgUrl: newsdata.imgurl,
                success: function () { },
                cancel: function () { }
            });
            wx.onMenuShareWeibo({
                title: newsdata.title,
                link: newsdata.link,
                imgUrl: newsdata.imgurl,
                success: function () { },
                cancel: function () { }
            });
            wx.onMenuShareQZone({
                title: newsdata.title,
                link: newsdata.link,
                imgUrl: newsdata.imgurl,
                success: function () { },
                cancel: function () { }
            });
        });
    }
}

/*--加载更多方法Seart--*/
var _LoadMore = {
    loading: false,
    lmbtn: $("#loadmore"),
    getTotalPage: function() {
        var pagesize;
        totalcount = this.lmbtn.data("totalcount"), pagesize = this.lmbtn.data("pagesize");
        if (pagesize == undefined) {
            pagesize = 20;
        }
        this.pageSize = pagesize;
        if (totalcount > 0 && pagesize > 0) {
            totalPage = Math.ceil(totalcount / pagesize);
        }
        return totalPage;
    },
    getPageIndex: function() {
        if (this.totalPage === 1) {
            this.lmbtn.hide();
        }
        var p = this.lmbtn.data("pageindex");
        if (p == undefined) {
            p = 1;
        }
        if (p <= 1) {
            var reg = new RegExp("(^|&)p=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            var o = 0;
            if (r != null)
                o = unescape(r[2]);
            if (o > 1) {
                p = o;
            }
        }
        return p;
    },
    totalPage: 0,
    pageSize: 0,
    p: 0,
    init: function() {
        this.totalPage = this.getTotalPage();
        this.p = this.getPageIndex();
        if (this.p > this.totalPage || this.totalPage < 2) {
            this.lmbtn.hide();
        }
        this.lmbtn.click(function() {
            if (_LoadMore.p !== "" && _LoadMore.p <= _LoadMore.totalPage) {
                _LoadMore.getMoreData();
            }
        });
    },
    getMoreData: function() {
        var p = this.p, totalPage = this.totalPage;
        var loadmore = this.lmbtn;
        var channelid = loadmore.data("channelid"), tagid = loadmore.data("tagid");
        if (channelid == undefined) {
            channelid = 0;
        }
        if (tagid == undefined) {
            tagid = 0;
        }
        var datatype = loadmore.data("datatype");
        var loadtype = loadmore.data("loadtype");
        var action = loadmore.data("ac-type");
        var posturl = "";
        var locationObj = $("#rewriteUrl"), locationUrl;
        if (locationObj.length > 0) {
            locationUrl = locationObj.val();
        } else {
            locationUrl = window.location.href;
        }
        locationUrl = locationUrl.replace(/([^~]+)&p=(\d+)([^~]+)?/ig, "$1$3").replace(/&/gm, "￥");
        if (action != undefined) {
            posturl = action + ".aspx?action=post&p=" + p + "&pagesize=" + this.pageSize + "&url=" + locationUrl;
        } else if (loadtype === "news-list" || loadtype === "newslist-all") {
            posturl = topPath +
                "/handlers/Handler.ashx?action=" +
                loadtype +
                "&p=" +
                p +
                "&pagesize=" +
                this.pageSize +
                "&url=" +
                locationUrl;
        } else if (loadtype === "search-list") {
            posturl = topPath +
                "/handlers/Handler.ashx?action=" +
                loadtype +
                "&p=" +
                p +
                "&t=" +
                loadmore.data("sourcetype") +
                "&w=" +
                loadmore.data("w");
        } else {
            posturl = topPath +
                "/handlers/Handler.ashx?action=getMoreData&cid=" +
                channelid +
                "&id=" +
                tagid +
                "&p=" +
                p +
                "&url=" +
                locationUrl;
            if (loadtype != undefined && loadtype !== "") {
                posturl = posturl + "&loadtype=" + loadtype;
            }
        }
        if (_LoadMore.loading) return;
        loadmore.html('玩命加载中，请稍候 <i class="icon icon-loadding"></i>...');
        _LoadMore.loading = true;
        $.post(posturl,
            function(result) {
                var datalist;
                if (loadtype != undefined && loadtype !== "") {
                    if (loadtype === "all") {
                        datalist = $("#" + loadtype);
                    } else if (loadtype === "search-list") {
                        var newsulname = $("#loadmore").data("newsulname");
                        datalist = $("#" + newsulname);
                    } else {
                        datalist = $("#" + loadtype);
                    }
                } else {
                    datalist = $("#newslist");
                }

                if ((Number(p)) === totalPage) {
                    $("#loadmore").hide();
                }
                _LoadMore.p = Number(p) + 1;
                $("#loadmore").html("加载更多");
                if (datalist.length > 0) {
                    var html = datalist.html() + result;
                    datalist.html(html);
                    callBackFunc();
                    //addShareBtn();
                }
                _LoadMore.loading = false;
            });
    }
};

/*--加载更多方法End--*/
function changeTarget() {
    if (bodyWidth <= 800) {
        $("#search").hide();
        $("a").each(function() { $(this).attr("target", "_self"); });
    }
}

/*--时间转换--*/
function dateConvert() {
    $(".tag")
        .find(".date")
        .each(function() {
            var time = $(this).html();
            var reg = /^(\d+)\-(\d+)\-(\d+) (\d+):(\d+)$/;
            if (reg.test(time)) {
                time = dataConvert(time);
                $(this).html(time);
            }
        });
}

/*--时间转换--*/
//拉伸图片
//拉伸图片
function imgAnimate() { $("img").lazyload({ placeholder: "https://static.pedaily.cn/images/noimage.jpg" }); }

/*----*/
function setNewsListSpecial() {
    var specialImgJson = [
        { "id": "1182", "text": "新三板", "url": "http://pe.pedaily.cn/new-third-board/", "t": "1" },
        { "id": "1060", "text": "天使", "url": "http://pe.pedaily.cn/investment/", "t": "1" },
        { "id": "1185", "text": "独角兽", "url": "http://news.pedaily.cn/unicorn/", "t": "1" },
        { "id": "19", "text": "巨头", "url": "http://pe.pedaily.cn/companyfocus/", "t": "1" },
        { "id": "1", "text": "互联网", "url": "http://news.pedaily.cn/i-internet/", "t": "2" },
        { "id": "2", "text": "移动互联网", "url": "http://news.pedaily.cn/i-mobilenternet/", "t": "2" },
        { "id": "3", "text": "医疗健康", "url": "http://news.pedaily.cn/i-medical-health/", "t": "2" },
        { "id": "4", "text": "环保能源", "url": "http://news.pedaily.cn/i-green-energy/", "t": "2" },
        { "id": "5", "text": "制造业", "url": "http://news.pedaily.cn/i-manufacturing/", "t": "2" },
        { "id": "6", "text": "消费", "url": "http://news.pedaily.cn/i-consume/", "t": "2" },
        { "id": "7", "text": "文化传媒娱乐", "url": "http://news.pedaily.cn/i-culture-media/", "t": "2" },
        { "id": "8", "text": "教育培训", "url": "http://news.pedaily.cn/i-education/", "t": "2" },
        { "id": "9", "text": "金融", "url": "http://news.pedaily.cn/i-finance/", "t": "2" },
        { "id": "10", "text": "传统", "url": "http://news.pedaily.cn/i-traditional/", "t": "2" },
        { "id": "11", "text": "IT", "url": "http://news.pedaily.cn/i-it/", "t": "2" },
        { "id": "12", "text": "农业", "url": "http://news.pedaily.cn/i-agriculture/", "t": "2" },
        { "id": "13", "text": "游戏", "url": "http://news.pedaily.cn/i-game/", "t": "2" },
        { "id": "14", "text": "投资", "url": "http://news.pedaily.cn/i-investment/", "t": "2" },
        { "id": "16", "text": "TMT", "url": "http://news.pedaily.cn/i-TMT/", "t": "2" },
        { "id": "30", "text": "电信服务", "url": "http://news.pedaily.cn/i-telecom-service/", "t": "2" },
        { "id": "32", "text": "传统消费", "url": "http://news.pedaily.cn/i-traditional-consumption/", "t": "2" },
        { "id": "33", "text": "旅游", "url": "http://news.pedaily.cn/i-tourism/", "t": "2" },
        { "id": "34", "text": "医疗服务", "url": "http://news.pedaily.cn/i-health-service/", "t": "2" },
        { "id": "35", "text": "医药", "url": "http://news.pedaily.cn/i-medicine/", "t": "2" },
        { "id": "36", "text": "健康产业", "url": "http://news.pedaily.cn/i-healthndustry/", "t": "2" },
        { "id": "37", "text": "文化产业", "url": "http://news.pedaily.cn/i-culturalndustry/", "t": "2" },
        { "id": "38", "text": "媒体", "url": "http://news.pedaily.cn/i-media/", "t": "2" },
        { "id": "39", "text": "影视", "url": "http://news.pedaily.cn/i-movies/", "t": "2" },
        { "id": "40", "text": "美股", "url": "http://news.pedaily.cn/i-us-stocks/", "t": "2" },
        { "id": "41", "text": "A股", "url": "http://news.pedaily.cn/i-A-stocks/", "t": "2" },
        { "id": "42", "text": "资产管理", "url": "http://news.pedaily.cn/i-asset-management/", "t": "2" }
    ];

    var specialTextJson = [
        { "id": "553", "text": "原创", "url": "http://www.pedaily.cn/original/", "css": "original" },
        { "id": "3", "text": "独家", "url": "http://www.pedaily.cn/dujia/", "css": "dujia" },
        { "id": "12", "text": "推荐", "url": "http://www.pedaily.cn/todayrecommend/", "css": "recommend" },
        { "id": "1030", "text": "热门", "url": "http://www.pedaily.cn/hotnews/", "css": "hot" }
    ];
    var ei = 0;
    var n = 0;
    var newsobj = $("#newstitle");
    if (newsobj.length > 0) {
        var special0 = "," + newsobj.data("special") + ",";
        if (newsobj.find("em.tj").length == 0) {
            for (var i = 0, l = specialTextJson.length; i < l; i++) {
                if (special0.indexOf("," + specialTextJson[i].id + ",") > -1) {
                    newsobj.append('<em class="tj ' +
                        specialTextJson[i].css +
                        '"><a href="' +
                        specialTextJson[i].url +
                        '" target="_blank">' +
                        specialTextJson[i].text +
                        "</a></em>");;
                    return;
                }
            }
        }
    }
    $(".news-list li")
        .each(function(index) {
            var special = "," + $(this).data("special") + ",";
            var industry = "," + $(this).data("industryid") + ",";
            n = index;
            if ($(this).find("em.tj").length == 0) {
                for (var i = 0, l = specialTextJson.length; i < l; i++) {
                    if (special.indexOf("," + specialTextJson[i].id + ",") > -1) {
                        if ($(this).parent().parent().hasClass("news-list-special")) {
                            $(this).addClass("special");
                        }
                        $(this)
                            .find("h3 a")
                            .before('<em class="tj ' +
                                specialTextJson[i].css +
                                '"><a href="' +
                                specialTextJson[i].url +
                                '" target="_blank">' +
                                specialTextJson[i].text +
                                "</a></em>");
                        break;
                    }
                }

            }

            if ($(this).find("span.s").length == 0) {
                for (var i = 0, l = specialImgJson.length; i < l; i++) {
                    if (specialImgJson[i].t == 1) {
                        if (special.indexOf("," + specialImgJson[i].id + ",") > -1) {
                            $(this)
                                .find(".img a")
                                .after('<span class="s s' +
                                    specialImgJson[i].id +
                                    '"><a href="' +
                                    specialImgJson[i].url +
                                    '" target="_blank">' +
                                    specialImgJson[i].text +
                                    "</a></span>");
                            return;
                        }
                    }
                    if (specialImgJson[i].t == 2) {
                        if (industry.indexOf("," + specialImgJson[i].id + ",") > -1) {
                            $(this)
                                .find(".img a")
                                .after('<span class="s h' +
                                    specialImgJson[i].id +
                                    '"><a href="' +
                                    specialImgJson[i].url +
                                    '" target="_blank">' +
                                    specialImgJson[i].text +
                                    "</a></span>");
                            return;
                        }
                    }
                }
            }

        });
    ei = $(".news-list li h3 em").length;
    //console.log(ei+':'+n);

    if (ei + 2 >= n) {

        $(".news-list li h3 em").hide();
    }


}

/*回调*/
function callBackFunc() {
    dateConvert();
    changeTarget();
	 if (bodyWidth > 801) { setNewsListSpecial();}
   
    loadNewsWaterFlow();
    imgAnimate();
    /*change2test();*/
}

/*----*/
function getQueryString(param) {
    var url = location.search; //获取url中"?"符后的字串
    var theRequest = "";
    if (url.indexOf("?") != -1) {
        var str = url.substr(1);
        strs = str.split("&");
        for (var i = 0; i < strs.length; i++) {
            if (strs[i].split("=")[0] == param) {
                theRequest = decodeURI(strs[i].split("=")[1]);
            }
        }
    }
    return theRequest;
}

/*----*/
function shareWbImg(id) {
    if (id <= 0)
        if ($("#final-content"))
            id = $("#final-content").data("id");

    var onerr = function() { win.warn("出现错误，请稍后重试！"); };
    $.ajax({
        url: topPath + "/handler.ashx?action=getwbimg&id=" + id,
        type: "GET",
        dataType: "json",
        beforeSend: win.wait,
        error: onerr,
        success: function(json) {
            if (json.success) {
                win.show({
                    title: "分享长微博",
                    content: '<div style="height:240px;overflow:auto;text-align:center;"><a target="_blank" href="' +
                        json.src +
                        '"><img src="' +
                        json.src +
                        '" style="margin:5px auto;"/></a></div>',
                    btntype: "diy",
                    width: 600,
                    height: 600,
                    btns: [],
                    ready: function() {
                        var a = $('<a href="javascript:void(0);" class="btn sharesina">分享到新浪微博</a>'),
                            b = $('<a href="javascript:void(0);" class="btn sharetengxun">分享到腾讯微博</a>'),
                            addlog = function(type) {
                                $.getJSON(topPath +
                                    "/handler.ashx?action=addsharelog&resid=" +
                                    id +
                                    "&type=" +
                                    type +
                                    "&_=" +
                                    new Date().getTime());
                            };
                        a.click(function() {
                            toSina(json.src, "【" + $("h1").text() + "】" + $("meta[name=description]").attr("content"));
                            addlog(1);
                        });
                        b.click(function() {
                            toQweibo(json
                                .src,
                                "【" + $("h1").text() + "】" + $("meta[name=description]").attr("content"));
                            addlog(2);
                        });
                        $("#btnlist").append(a).append(b);
                    }
                });
            } else {
                onerr();
            }
        }
    });
}

/*----*/
//打开二维码
function openQrCode(obj) {
    obj = $(obj);
    var url = document.location.href;
    //var re = /(\d+)\.shtml/;
    //if (!re.test(url)) return;
    var onerr = function() { win.warn("出现错误，请稍后重试！"); };
    $.ajax({
        url: topPath + "/handler.ashx?action=getqrcode&url=" + url,
        type: "post",
        dataType: "json",
        beforeSend: win.wait,
        error: onerr,
        success: function(json) {
            if (json.success) {
                win.show({
                    title: "分享到微信朋友圈",
                    content: '<div style="overflow:hidden;text-align:center;padding:25px;"><img src="' +
                        json.src +
                        '" style="margin:5px auto;"/></div>',
                    btntype: "diy",
                    width: 400,
                    class1: "weixin-winbox",
                    btns: [],
                    ready: function() {
                        $("#btnlist").append("打开微信，点击底部的“发现”，使用 “扫一扫” 即可将网页分享到我的朋友圈。");
                    }
                });
            } else {
                onerr();
            }
        }
    });
}

/*----*/
function toSina(pic, txt) { Share(pic, txt, "sina"); }

/*----*/
function toQweibo(pic, txt) { Share(pic, txt, "qwb"); }

/*----*/
function Share(pic, txt, type) {
    var s = screen,
        d = document,
        e = encodeURIComponent,
        r = "投资界",
        l = "http://www.pedaily.cn/",
        c = "utf-8",
        u = d.location;
    if (type == "sina") {
        var f = "http://v.t.sina.com.cn/share/share.php?appkey=372732463&",
            p = [
                "url=", e(u), "&title=", e(txt), "&source=", e(r), "&sourceUrl=", e(l), "&content=", c, "&pic=", e(pic)
            ].join("");

        function a() {
            if (!window.open([f, p].join(""),
                "mb",
                [
                    "toolbar=0,status=0,resizable=1,width=440,height=430,left=", (s.width - 440) / 2, ",top=",
                    (s.height - 430) / 2
                ].join(""))) u.href = [f, p].join("");
        };

        if (/Firefox/.test(navigator.userAgent)) setTimeout(a, 0);
        else a();
    } else if (type == "qwb") {
        var _u = "http://v.t.qq.com/share/share.php?title=" +
            e(txt) +
            "&url=" +
            e(u) +
            "&appkey=" +
            encodeURI("801005846") +
            "&site=" +
            l +
            "&pic=" +
            e(pic);
        window.open(_u,
            "",
            [
                "toolbar=0,status=0,resizable=1,width=612,height=446,left=", (s.width - 612) / 2, ",top=",
                (s.height - 446) / 2
            ].join(""));
    }
}

/*Form相关*/
var _Form = {
    init: function() {
        this.addValidate();
    },
    addValidate: function() {
        /*注册验证事件*/
        jQuery.validator.addMethod("checkEmail",
            function(value, element, param, error, cannull) {
                if (!$.validator.methods["email"].call(this, value, element, param, error, cannull)) {
                    return "请填写正确格式的邮箱！";
                }
                if (error === "")
                    error = "邮箱已被占用，请使用其他邮箱!";
                var flag = false;
                $.ajax({
                    type: "post",
                    async: false,
                    cache: false,
                    url: "/handlers/handler.ashx?action=checkemail&email=" + value + "&t=" + Math.random(),
                    success: function(result) {
                        if (result) {
                            if (result.code == 1) {
                                flag = true;
                            }
                        }
                    },
                    error: function() { flag = false; },
                    dataType: "json"
                });
                return flag ? true : error;
            });

        jQuery.validator.addMethod("dateint",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var data = /^\d{6,8}$/;
                return data.test($.trim(value));
            });

        //身份证验证
        jQuery.validator.addMethod("idcard",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var idcard = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;
                return idcard.test(value);
            });

        jQuery.validator.addMethod("passport",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var idcard = /^1[45][0-9]{7}|G[0-9]{8}|P[0-9]{7}|S[0-9]{7,8}|D[0-9]+$/;
                return idcard.test(value);
            });

        jQuery.validator.addMethod("checkNickname",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var data = "&nickname=" + value + "&uid=" + param;;
                var flag = false;
                $.ajax({
                    type: "post",
                    async: false,
                    cache: false,
                    url: "/handlers/handler.ashx?action=checkuname&username=" + value + "&field=2&uid=" + param,
                    data: data,
                    success: function(result) {
                        if (result) {
                            if (result.code == 1) {
                                flag = true;
                            }
                        }
                    },
                    error: function() { flag = false; },
                    dataType: "json"
                });
                return flag ? true : "昵称已被占用!";
            });

        //验证码验证
        jQuery.validator.addMethod("checkValidcode",
            function(value, element, param, error, cannull) {
                var data = "&code=" + value;
                var flag = false;
                $.ajax({
                    type: "post",
                    async: false,
                    cache: false,
                    url: "/handlers/handler.ashx?action=checkvcode",
                    data: data,
                    success: function(result) {
                        if (result) {
                            if (result.code == 1) {
                                flag = true;
                            } else {
                                $("#form_login #loginvcodeimg").click();
                            }
                        }
                    },
                    error: function() { flag = false; },
                    dataType: "json"
                });
                return flag;
            });

        jQuery.validator.addMethod("checkMobileOReMailResetPWD",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var emailvalidate = $.validator.methods["email"].call(this, value, element, param, error, cannull);
                var mobilevalidate = $.validator.methods["mobile"].call(this, value, element, param, error, cannull);
                if (emailvalidate === false && mobilevalidate === false) {
                    return "输入格式有误，请输入邮箱或手机号码";
                }
                var data = "&data=" + value + "&type=" + (emailvalidate ? 1 : 0);
                var flag = false;
                var errormsg = "";
                $.ajax({
                    type: "post",
                    async: false,
                    cache: false,
                    url: "/handlers/Handler.ashx?action=MobileOReMailForReset",
                    data: data,
                    success: function(result) {
                        if (result) {
                            if (result.code === 1) {
                                flag = true;
                            } else {
                                errormsg = result.msg;
                            }
                        }
                    },
                    error: function() { errormsg = "系统错误，请联系管理员"; },
                    dataType: "json"
                });
                return flag ? true : errormsg;
            });

        jQuery.validator.addMethod("checkMobileResetPWD",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var mobilevalidate = $.validator.methods["mobile"].call(this, value, element, param, error, cannull);
                if (mobilevalidate === false) {
                    return "输入格式有误，请输入正确格式的手机号码";
                }
                var data = "&mobile=" + value;
                var flag = false;
                var errormsg = "";
                $.ajax({
                    type: "post",
                    async: false,
                    cache: false,
                    url: "/handlers/Handler.ashx?action=MobileForReset",
                    data: data,
                    success: function(result) {
                        if (result) {
                            if (result.code === 1) {
                                flag = true;
                            } else {
                                errormsg = result.msg;
                            }
                        }
                    },
                    error: function() { errormsg = "系统错误，请联系管理员"; },
                    dataType: "json"
                });
                return flag ? true : errormsg;
            });

        // 联系电话(手机/电话皆可)验证
        jQuery.validator.addMethod("isPhone",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var mobile = /^((1[0-9]{2})\d{8})$/;
                var tel = /^d{3,4}-?d{7,9}$/;
                return (tel.test(value) || mobile.test(value));
            });

        // 验证是否为数字     
        jQuery.validator.addMethod("number",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var num = /^\d+$/;
                return (num.test(value));
            });

        // 验证金额     
        jQuery.validator.addMethod("decimal",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var num = /^([1-9][\d]{0,7}|0)(\.[\d]{1,2})?$/;
                return (num.test(value));
            });

        // 邮政编码验证       
        jQuery.validator.addMethod("isZipCode",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                var tel = /^[0-9]{6}$/;
                return (tel.test(value));
            });

        // 字符验证       
        jQuery.validator.addMethod("stringCheck",
            function(value, element, param, error, cannull) {
                if ($.validator.CheckCanNull(value, element, cannull)) {
                    return true;
                }
                return /^[\u0391-\uFFE5\w]+$/.test(value);
            });
    },
    addFormSuccess: function(element) {
        element = $(element);
        this.clean(element);
        element.closest(".form-group").removeClass("has-error");
        //$parent.append('<span class="' + window['succeedclass'] + '">' + okMsg + '</span>');
    },
    addFormError: function(element, errormsg) {
        element = $(element);
        this.clean(element);
        element.closest(".form-group").addClass("has-error");
        var inputgroup = element.parent(".input-group");
        var error = "<span class=\"error-info\">" + errormsg + "</span>";
        if (inputgroup.length > 0) {
            inputgroup.parent().append(error);
        } else {
            element.parent().append(error);
        }
        //element.parent().append('<span class="' + window['errorclass'] + '">' + errormsg + '</span>');
    },
    clean: function(element) {
        if (!window["errorclass"]) window["errorclass"] = "error-info";
        if (!window["succeedclass"]) window["succeedclass"] = "success-info";
        var parent = $(element).closest(".form-group");
        parent.find("." + window["errorclass"]).remove();
        parent.find("." + window["succeedclass"]).remove();
    },
    showResult: function(data, lResult, showurl) {
        if (lResult) {
            if (data.msg) {
                lResult.html(data.msg);
            }
            if (data.code == 1) {
                lResult.removeClass("form-error").removeClass("form-success").addClass("form-success");
                if (showurl) {
                    window.location.href = showurl;
                }
            } else {
                lResult.removeClass("form-error").removeClass("form-success").addClass("form-error");
            }
        }
    },
    setCookie: function(data) {
        if (data.code == 1) {
            var cookies = data.SetCookie;
            //document.cookie = data.SetCookie;
            if (!cookies) {
                return;
            }
            cookies = cookies.replace("\u0026", "&");
            var kt = _Common.getparam(cookiename, cookies),
                expires = _Common.getparam("expires", cookies),
                path = _Common.getparam("path", cookies),
                domain = _Common.getparam("domain", cookies);
            Cookies.Set(cookiename, kt, expires, path, domain);
            users.init();
        }
    }
};
/*----*/
var _Common = {
    getElementByClass: function(classname) { return $("." + classname); },
    getElementByID: function(id) {
        if (id) {
            return $("#" + id);
        }
        return null;
    },
    getparam: function(key, obj) {
        var reg = new RegExp(String.format("{0}=([^;]+)", key), "i");
        var r = obj.match(reg);
        var value = "";
        if (r != null) value = r[1];
        return value;
    },
    Uploadimage: function (fileid, imageid, saveid, imagetype, maxwidth, maxheight,iscommon) {
        var formdata = new FormData();
        formdata.append("imagetype", imagetype);
        formdata.append("maxwidth", maxwidth);
        formdata.append("maxheight", maxheight);
        var fileObj = document.getElementById(fileid).files;
        var $file = $("#" + fileid);
        for (var i = 0; i < fileObj.length; i++)
            formdata.append("file" + i, fileObj[i]);
        var url = '/handlers/handler.ashx?action=upload';
        if (iscommon) {
            url = "/top/handlers/handler.ashx?action=upload";
        }
        $.ajax({
                type: "Post",
                url: url,
                data: formdata,
                /**
                *必须false才会自动加上正确的Content-Type
                */
                contentType: false,
                /**
                * 必须false才会避开jQuery对 formdata 的默认处理
                * XMLHttpRequest会对 formdata 进行正确的处理
                */
                processData: false
            })
            .then(function(data) {
                    if (data.code === 1) {
                        var img = $("#" + imageid);
                        var close = img.closest("form-group").find("close");
                        $("#" + imageid).attr("src", data.url).removeClass("hide");
                        if (close.length < 1) {
                            img.after('<span aria-hidden="true" class="close">×</span>');
                            bindClose();
                        }
                        $("#" + saveid).val(data.url);
                        _Form.addFormSuccess($file);
                    } else {
                        _Form.addFormError($file, data.msg);
                    }
                },
                function() {
                    //failCal
                });
    },
    isWeixin:function() {
        var ua = navigator.userAgent.toLowerCase();
        if (ua.match(/micromessenger/i) == "micromessenger") {
            return true;
        } else {
            return false;
        }
    },
    loadScript:function (url, callback) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        if (typeof(callback) != "undefined") {
            if (script.readyState) {
                script.onreadystatechange = function() {
                    if (script.readyState == "loaded" || script.readyState == "complete") {
                        script.onreadystatechange = null;
                        callback();
                    }
                };
            } else {
                script.onload = function() {
                    callback();
                };
            }
        };
        script.src = url;
        document.body.appendChild(script);
    }
};

function bindClose() {
    var close = $(".form-group .close");
    if (close.length > 0) {
        close.click(function() {
            var formgroup = $(this).closest(".form-group");
            formgroup.find("input").val("");
            formgroup.find("img").attr("src", "");
            formgroup.find(".text-img").val("点击上传");
            $(this).remove();
        });
    }

}

var _PhoneValidate = {
    intervalid:0,
    timer: function(o, wait, type,vcodebtnid) {
        if (wait === 50) {
            var mobile = $("#mobile").val(), vcode = $("#validcode").val();
            if ($.trim(mobile).length <= 5) {
                _Form.addFormError($("#mobile"), "手机号不正确");
                return;
            }
            if ($.trim(vcode).length <= 0) {
                _Form.addFormError($("#validcode"), "验证码不可为空");
                return;
            }
            var codecheck = false;
            $.ajax({
                type: 'post',
                async: false,
                cache: false,
                url: '/handlers/handler.ashx?action=CheckVcode',
                data: { code: vcode },
                success: function (result) {
                    if (result.code === 1) {
                        _Form.addFormSuccess($('#validcode'));
                        codecheck = true;
                    }
                    if (result.code === 0) {
                        _Form.addFormError($('#validcode'), result.msg);
                        return;
                    }
                },
                error: function () { },
                dataType: 'json'
            });
            if (!codecheck) return;
            if (!type) {
                type = 0;
            }
            var vcodebtn = $('#' + vcodebtnid);
            var data = { mobile: mobile, code: vcode, action: type };
            $.ajax({
                type: "post",
                url: "/handlers/sms.ashx",
                data: data,
                success:
                    function (result) {
                        if (vcodebtn.length > 0) vcodebtn.click();
                        if (result.code == 1) {
                            //_Form.showResult(result, $('#form_error'), '');
                        } else {
                            _Form.showResult(result, $("#form_error"), result.msg);
                            //clearTimeout(_PhoneValidate.intervalid);
                            wait = 0;
                            return;
                        }
                    },
               error: function (result) {
                   if (vcodebtn.length > 0) vcodebtn.click();
                   _Form.showResult(result, $("#form_error"), "手机验证码发送失败，请稍后再试...");
                   //clearTimeout(_PhoneValidate.intervalid);
                   wait = 0;
                   return;
                },
                dataType: "json"
            });
        }
        if (wait === 0) {
            o.removeAttribute("disabled");
            o.value = "免费获取验证码";
            //$('#vcodeimg').click();
            //$('#validcode').val('');
        } else {
            //发送验证码到手机
            o.setAttribute("disabled", true);
            o.value = "重新发送(" + wait + ")";
            wait--;
            _PhoneValidate.intervalid = setTimeout(function() {
                    _PhoneValidate.timer(o, wait);
                },
                1000);
        }
    },
    hidemobileValidate: function() {
        $("#phonetip").html("");
        $("#mobilevalidated").hide();
        $("#ismobilevalidated").attr("checked", false);
        $("#ismobilevalidated").parent().removeClass("checked");
        $("#validate").val("0");
    }
};
$(document)
        .on("mouseenter",
            ".navlink-wechat",
            function() {
                var a = $(this), b = a.find(".nav-wechat");
                a.hasClass("disabled") ||
                (a.addClass("disabled"),
                    b.stop()
                        .css({
                            opacity: "0",
                            bottom: "-180px"
                        })
                        .show()
                        .animate({
                                opacity: "1",
                                bottom: "-165px"
                            },
                            300));
            }),
    $(document)
        .on("mouseleave",
            ".navlink-wechat",
            function() {
                var a = $(this), b = a.find(".nav-wechat");
                b.hide();
                a.removeClass("disabled");
            }),
    $(document)
        .on("mouseenter",
            ".navlink-pad",
            function() {
                var a = $(this), b = a.find(".nav-pad");
                a.hasClass("disabled") ||
                (a.addClass("disabled"),
                    b.stop()
                        .css({
                            opacity: "0",
                            bottom: "-180px"
                        })
                        .show()
                        .animate({
                                opacity: "1",
                                bottom: "-165px"
                            },
                            300));
            }),
    $(document)
        .on("mouseleave",
            ".navlink-pad",
            function() {
                var a = $(this), b = a.find(".nav-pad");
                b.hide();
                a.removeClass("disabled");
            });

function winAlert(msg, o) {
    if ($(".modelcomment").length > 0) {
        alert(msg);
    } else {
        win.alert({ title: "提示", content: msg, timeout: o > 0 ? o : 2000, cover: true });
    }
}

function getDateArr(date) {
    var l = new Array();
    if (date == undefined) {
        date = new Date();
    }
    var month = date.getMonth() + 1, day = date.getDate();
    if (month < 10) {
        month = "0" + month;
    }
    if (day < 10) {
        day = "0" + day;
    }
    l.push(date.getFullYear());
    l.push(month);
    l.push(day);
    l.push(date.getHours());
    l.push(date.getMinutes());
    l.push(date.getSeconds());
    l.push("日一二三四五六".charAt(date.getDay()));
    return l;
}

